{% extends "admin/base.html" %}
{% load static admin_sidebar jazzmin i18n %}

{% block extrahead %}
  {{ block.super }}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    {% include "admin/includes/admin_overrides.css" %}
  </style>
{% endblock %}

{% block sidebar %}
  {% if jazzmin_settings.show_sidebar %}
    {% build_admin_sidebar as structured_sidebar %}
    {% get_side_menu as side_menu_list %}

    <aside class="main-sidebar elevation-4 {{ jazzmin_ui.sidebar_classes }}" id="jazzy-sidebar">
      <a href="{% url 'admin:index' %}" class="brand-link {{ jazzmin_ui.brand_classes }}" id="jazzy-logo">
        <img src="{% static jazzmin_settings.site_logo %}" alt="{{ jazzmin_settings.site_header }} Logo" class="{{ jazzmin_settings.site_logo_classes }} brand-image elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">{{ jazzmin_settings.site_brand }}</span>
      </a>

      <div class="sidebar">
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            {% if jazzmin_settings|has_jazzmin_setting:"user_avatar" %}
              <img src="{% get_user_avatar request.user %}" width="160px" class="img-circle elevation-2" alt="User Image">
            {% else %}
              <i class="fas fa-inverse user-profile fa-user-circle"></i>
            {% endif %}
          </div>
          <div class="info">
            {% if perms|can_view_self %}
              <a href="{% jazzy_admin_url request.user request.current_app|default:"admin" %}" class="d-block">{{ request.user }}</a>
            {% else %}
              <span class="d-block" style="color: white;">{{ request.user }}</span>
            {% endif %}
          </div>
        </div>

        <nav class="mt-2">
          {% with current_view=request.resolver_match.view_name|default:'' %}
          <ul class="nav nav-pills nav-sidebar flex-column {{ jazzmin_ui.sidebar_list_classes }}" data-widget="treeview" data-accordion="false" role="menu">
            <li class="nav-item">
              <a href="{% url 'admin:index' %}" class="nav-link{% if current_view == 'admin:index' %} active{% endif %}">
                <i class="nav-icon fas fa-th-large"></i>
                <p>{% trans 'Dashboard' %}</p>
              </a>
            </li>

            {% if structured_sidebar %}
              {% for section in structured_sidebar %}
                <li class="nav-header">{{ section.label }}</li>
                {% for group in section.groups %}
                  <li class="nav-item has-treeview{% if group.is_open %} menu-open{% endif %}">
                    <a href="javascript:void(0)" class="nav-link{% if group.is_open %} active{% endif %}">
                      <i class="nav-icon {{ group.icon }}"></i>
                      <p>
                        {{ group.label }}
                        {% if group.badge %}
                          <span class="nav-badge">{{ group.badge }}</span>
                        {% endif %}
                        <i class="fas fa-angle-left right"></i>
                      </p>
                    </a>
                    <ul class="nav nav-treeview"{% if group.is_open %} style="display:block"{% endif %}>
                      {% for item in group.items %}
                        <li class="nav-item">
                          <a href="{{ item.url }}" class="nav-link{% if item.is_active %} active{% endif %}">
                            <i class="nav-icon {{ item.icon }}"></i>
                            <p>{{ item.label }}</p>
                          </a>
                        </li>
                      {% endfor %}
                    </ul>
                  </li>
                {% endfor %}
              {% endfor %}
            {% else %}
              {% if jazzmin_settings.navigation_expanded %}
                {% for app in side_menu_list %}
                  <li class="nav-header">{{ app.name }}</li>
                  {% for model in app.models %}
                    <li class="nav-item">
                      {% if model.url %}
                        <a href="{{ model.url }}" class="nav-link">
                          <i class="nav-icon {{ model.icon }}"></i>
                          <p>{{ model.name }}</p>
                        </a>
                      {% else %}
                        <span class="nav-link disabled">
                          <i class="nav-icon {{ model.icon }}"></i>
                          <p>{{ model.name }}</p>
                        </span>
                      {% endif %}
                    </li>
                  {% endfor %}
                {% endfor %}
              {% else %}
                {% for app in side_menu_list %}
                  <li class="nav-item has-treeview">
                    <a href="#" class="nav-link">
                      <i class="nav-icon {{ app.icon }}"></i>
                      <p>{{ app.name|truncatechars:21 }} <i class="fas fa-angle-left right"></i></p>
                    </a>
                    <ul class="nav nav-treeview" style="display: none;">
                      {% for model in app.models %}
                        <li class="nav-item">
                          <a href="{% if model.url %}{{ model.url }}{% else %}javascript:void(0){% endif %}" class="nav-link">
                            <i class="nav-icon {{ model.icon }}"></i>
                            <p>{{ model.name }}</p>
                          </a>
                        </li>
                      {% endfor %}
                    </ul>
                  </li>
                {% endfor %}
              {% endif %}
            {% endif %}
          </ul>
          {% endwith %}
        </nav>
      </div>
    </aside>
  {% endif %}
{% endblock %}
