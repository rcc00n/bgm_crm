{% load calendar_filter %}
<div class="scrollable">
    <table class="calendar-table">
        <thead>
        <tr>
            <th class="time-col"></th>
            {% for master in masters %}
                <th class="master-col">
                    <div class="master-header">
                        <div class="initials-circle">
                            {{ master.first_name|slice:":1" }}{{ master.last_name|slice:":1" }}
                        </div>
                        <div class="master-name">
                            {{ master.first_name }} {{ master.last_name }}
                        </div>
                    </div>
                </th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in calendar_table %}
            <tr>
                <td class="time-col">
                    {% if forloop.first or forloop.counter0|divisibleby:4 %}
                        {{ row.time|string_to_ampm  }}
                    {% endif %}
                </td>
                {% for cell in row.cells %}
                    {% if cell.skip %}
                        {# пустая ячейка, которую уже занял rowspan #}
                    {% else %}
                        {% if cell.rowspan > 1 %}
                            <td rowspan="{{ cell.rowspan }}"
                                class="event"
                                onclick="window.location.href='/admin/core/appointment/{{cell.appt_id}}/change/'"
                                data-client="{{ cell.client }}"
                                data-phone="{{ cell.phone }}"
                                data-service="{{ cell.service }}"
                                data-status="{{ cell.status }}"
                                data-master="{{ cell.master }}"
                                data-time-label="{{ cell.time_label }}"
                                data-duration="{{ cell.duration }}"
                                data-price="{{ cell.price }}">
                                <div>{{ cell.html|safe }}</div>


                            </td>
                        {% else %}
                            <td >
                                <div class="calendar-cell"
                                     data-time="{{ row.time|string_to_ampm }}"
                                     data-time-label="{{ row.time|string_to_ampm }}"
                                     data-master="{{ cell.master_id }}"
                                     onclick="showAddPopup(event, '{{ row.time }}', '{{ row.time|string_to_ampm }}')">

                                </div>

                            </td>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>