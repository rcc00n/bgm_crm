{% extends "admin/base_site.html" %}
{% load static %}
{% block breadcrumbs %}{% endblock %}
{% block content_title %}{% endblock %}
{% block object-tools %}{% endblock %}
{% block title %}Daily Calendar{% endblock %}
{% block extrahead %}
    {{ block.super }}
    <script defer src="{% static 'admin/js/appointments.js' %}"></script>
    <!-- <link rel="stylesheet" href="{% static 'admin/css/custom_sidebar.css' %}">
    <script defer src="{% static 'admin/js/custom_sidebar.js' %}"></script> -->
{% endblock %}
{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'admin/css/appointments.css' %}">
{% endblock %}
{% block content %}
    <div class="calendar-shell">
        <div class="calendar-nav">
            <div class="calendar-left">
                <button class="nav-btn" onclick="changeDateToToday()">Today</button>

                <div class="nav-group">
                    <button class="nav-icon2" onclick="changeDateByDays(-1)">&lt;</button>
                    <div class="fake-date-picker" onclick="document.getElementById('realDateInput').showPicker()">
                        <span id="displayDate">{{ selected_date|date:"Y-m-d" }}</span>
                        <input
                                type="date"
                                id="realDateInput"
                                value="{{ selected_date|date:'Y-m-d' }}"
                                onchange="onDateChange(this.value)"
                        />
                    </div>
                    <button class="nav-icon2" onclick="changeDateByDays(1)">&gt;</button>
                </div>

                <div class="view-toggle" role="tablist" aria-label="Calendar view">
                    <button type="button" class="view-btn {% if calendar_view == 'day' %}active{% endif %}" data-view="day" onclick="setCalendarView('day')">Day</button>
                    <button type="button" class="view-btn {% if calendar_view == 'week' %}active{% endif %}" data-view="week" onclick="setCalendarView('week')">Week</button>
                    <button type="button" class="view-btn {% if calendar_view == 'month' %}active{% endif %}" data-view="month" onclick="setCalendarView('month')">Month</button>
                </div>

                <button class="nav-icon2" id="nav-icon2" style="border-radius: 10px;">
                    <img src="https://img.icons8.com/?size=100&id=O7hGF9n2ssaW&format=png&color=000000"
                         alt="Filter" style="width: 2.2vh; height: 2.2vh;">
                </button>
            </div>

            <div class="calendar-right">
                <div class="add-dropdown">
                    <button id="addDropdownBtn" class="add-appointment-btn">Add <span id="arrow">‚ñæ</span></button>
                    <div id="addDropdownMenu" class="add-dropdown-menu hidden">
                        <a href="#" onclick="handleAdd('appointment')">üìÖ Appointment</a>

                        <a href="#" onclick="handleAdd('vacation')">‚ùå Blocked time</a>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Sidebar -->
    <div id="filterSidebar" class="sidebar2 hidden">
        <div class="sidebar-header2">
            <h3>All filters</h3>
            <button class="close-btn2" onclick="closeSidebar()">‚úï</button>
        </div>


        <form id="filterForm">
            <div class="filter-section">
                <div class="filter-header" onclick="toggleSection(this)">
                    üìÖ Appointment status <span class="arrow">‚åÑ</span>
                </div>
                <div class="filter-content">
                    {% for status in appointment_statuses %}
                        <label class="checkbox-wrapper">
                            <input type="checkbox" name="status" value="{{ status.id }}">
                            <span>{{ status.name }}</span>
                        </label>
                    {% endfor %}
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header" onclick="toggleSection(this)">
                    üí≥ Payment status <span class="arrow">‚åÑ</span>
                </div>
                <div class="filter-content">
                    {% for ps in payment_statuses %}
                        <label class="checkbox-wrapper">
                            <input type="checkbox" name="payment_status" value="{{ ps.id }}">
                            <span>{{ ps.name }}</span>
                        </label>
                    {% endfor %}
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header" onclick="toggleSection(this)">
                    üè∑Ô∏è Services <span class="arrow">Edit</span>
                </div>
                <div class="filter-content">
                    <select name="service" id="serviceSelect">
                        <option value="">All</option>
                        {% for service in services %}
                            <option value="{{ service.id }}">{{ service.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="filter-footer">
                <button type="submit" class="apply-btn">Apply filters</button>
                <button type="button" onclick="clearAllFilters()" class="clear-btn">Clear filters</button>
            </div>
        </form>
    </div>
    <div id="calendar-container">
        {% include "admin/appointments_calendar_partial.html" %}
    </div>
    <input type="hidden" id="calendarView" value="{{ calendar_view|default:'week' }}">
    <div id="addPopup" class="popup hidden">
        <div class="popup-header">
            <span id="popupTime">Time</span>
            <button class="popup-close" onclick="closePopup()">‚úï</button>
        </div>
        <div class="popup-body">
        </div>
    </div>
    <div id="qaOverlay" class="qa-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="qaTitle">
        <div class="qa-dialog" role="document">
            <div class="qa-head">
                <div class="qa-head__meta">
                    <div class="qa-kicker">New appointment</div>
                    <div class="qa-title" id="qaTitle">Pick a time slot</div>
                    <div class="qa-sub" id="qaSub">Fast add without leaving the calendar</div>
                </div>
                <button type="button" class="qa-close" onclick="closeQuickAdd()" aria-label="Close">‚úï</button>
            </div>
            <form id="qaForm" class="qa-body" onsubmit="submitQuickAdd(event)">
                <input type="hidden" name="date" id="qaDate" value="">
                <input type="hidden" name="time" id="qaTime" value="">
                <input type="hidden" name="client" id="qaClientId" value="">

                <div class="qa-grid qa-grid--2">
                    <div class="qa-field qa-field--full">
                        <label class="qa-label" for="qaClientSearch">Client (optional)</label>
                        <div class="qa-client">
                            <input id="qaClientSearch" class="qa-input" type="text" placeholder="Search name, email, phone" autocomplete="off" />
                            <div id="qaClientResults" class="qa-results hidden" role="listbox" aria-label="Client results"></div>
                        </div>
                        <div class="qa-hint">Leave empty for guest bookings.</div>
                    </div>

                    <div class="qa-field">
                        <label class="qa-label" for="qaName">Name</label>
                        <input id="qaName" name="contact_name" class="qa-input" type="text" placeholder="Full name" />
                    </div>
                    <div class="qa-field">
                        <label class="qa-label" for="qaPhone">Phone</label>
                        <input id="qaPhone" name="contact_phone" class="qa-input" type="tel" placeholder="+1 ..." />
                    </div>
                    <div class="qa-field qa-field--full">
                        <label class="qa-label" for="qaEmail">Email</label>
                        <input id="qaEmail" name="contact_email" class="qa-input" type="email" placeholder="name@example.com" />
                    </div>
                </div>

                <div class="qa-grid qa-grid--2">
                    <div class="qa-field">
                        <label class="qa-label" for="qaMaster">Tech</label>
                        <select id="qaMaster" name="master" class="qa-select">
                            <option value="">Select tech</option>
                            {% for m in masters %}
                                <option value="{{ m.id }}">{{ m.first_name }} {{ m.last_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="qa-field">
                        <label class="qa-label" for="qaService">Service</label>
                        <select id="qaService" name="service" class="qa-select">
                            <option value="">Select service</option>
                            {% for service in services %}
                                <option value="{{ service.id }}">{{ service.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="qa-field">
                        <label class="qa-label" for="qaStatus">Status</label>
                        <select id="qaStatus" name="status" class="qa-select">
                            <option value="">Select status</option>
                            {% for st in appointment_statuses %}
                                <option value="{{ st.id }}"
                                        {% if st.name == "Scheduled" or st.name == "Booked" or st.name == "Confirmed" %}selected{% endif %}>
                                    {{ st.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="qa-field">
                        <label class="qa-label" for="qaPayment">Payment</label>
                        <select id="qaPayment" name="payment_status" class="qa-select">
                            <option value="">Select payment status</option>
                            {% for ps in payment_statuses %}
                                <option value="{{ ps.id }}"
                                        {% if ps.name == "Unpaid" or ps.name == "Pending" %}selected{% endif %}>
                                    {{ ps.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div id="qaErrors" class="qa-errors hidden" aria-live="polite"></div>

                <div class="qa-actions">
                    <button type="button" class="qa-btn qa-btn--ghost" onclick="closeQuickAdd()">Cancel</button>
                    <button type="submit" class="qa-btn qa-btn--primary" id="qaSubmit">Create appointment</button>
                </div>
            </form>
        </div>
    </div>
    <div id="apptTooltip" class="appt-tooltip hidden"></div>

{% endblock %}
