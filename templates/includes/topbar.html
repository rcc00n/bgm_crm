{% load static %}
{% with resolver=request.resolver_match %}
{% with view_name=resolver.view_name|default:'' namespace=resolver.namespace|default:'' %}
{% with
    is_store=namespace == 'store' or view_name|slice:":5" == 'store'
    is_services=view_name == 'client-dashboard' or view_name == 'mainmenu'
    is_merch=view_name == 'merch'
    is_financing=view_name == 'financing'
    is_about=view_name == 'our-story'
    is_dealer=view_name == 'dealer-status' or view_name == 'dealer-apply'
    is_portal=view_name|slice:":9" == 'dashboard' or view_name == 'client_appointments'
%}
<header class="site-header" role="banner">
  <div class="container site-header__inner">
    <a class="brand" href="{% url 'home' %}">
      <span class="brand__logo">
        <span class="brand__word brand__word--white">BAD GUY</span>
        <span class="brand__word brand__word--red">MOTORS</span>
      </span>
      <span class="brand__tagline">CUSTOM BUILDS • INSTALLS • UPGRADES</span>
    </a>

    <button class="site-header__toggle" type="button" aria-expanded="false" aria-controls="siteNav">
      <span class="site-header__toggle-box" aria-hidden="true">
        <span class="site-header__toggle-lines"></span>
      </span>
      <span class="sr-only">Toggle navigation</span>
    </button>

    <nav id="siteNav" aria-label="Main navigation">
      <ul>
        <li>
          <a href="{% url 'client-dashboard' %}"
             {% if is_services %}aria-current="page"{% endif %}
             title="Services catalog">
            Services
          </a>
        </li>

        {% if user.is_authenticated %}
          <li>
            <a href="{% url 'dashboard' %}"
               {% if is_portal %}aria-current="page"{% endif %}>
              Client Portal
            </a>
          </li>
        {% else %}
          <li>
            <a class="btn btn--ghost" href="{% url 'login' %}?next={% url 'dashboard' %}">
              Login
            </a>
          </li>
        {% endif %}

        <li>
          <a href="{% url 'store' %}"
             {% if is_store %}aria-current="page"{% endif %}>
            Products
          </a>
        </li>
        <li>
          <a href="{% url 'merch' %}"
             {% if is_merch %}aria-current="page"{% endif %}>
            Merch <span class="badge">Soon</span>
          </a>
        </li>
        <li>
          {% if dealer_portal and dealer_portal.show_discount %}
            <a class="badge badge--dealer"
               href="{% url 'dealer-status' %}"
               {% if is_dealer %}aria-current="page"{% endif %}>
              Dealer {{ dealer_portal.tier_label }}
            </a>
          {% else %}
            <a href="{% url 'dealer-status' %}"
               {% if is_dealer %}aria-current="page"{% endif %}>
              Dealers
            </a>
          {% endif %}
        </li>
        <li>
          <a href="{% url 'financing' %}"
             {% if is_financing %}aria-current="page"{% endif %}>
            Financing
          </a>
        </li>
        <li>
          <a href="{% url 'our-story' %}"
             {% if is_about %}aria-current="page"{% endif %}>
            About
          </a>
        </li>
      </ul>
    </nav>
  </div>
</header>
<script defer src="{% static 'js/topbar.js' %}"></script>
{% endwith %}
{% endwith %}
{% endwith %}
