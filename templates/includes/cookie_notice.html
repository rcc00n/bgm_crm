<style id="cookie-notice-style">
  .cookie-notice{
    position:fixed;
    inset:auto auto 18px 18px;
    max-width:420px;
    padding:1rem 1.1rem;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.16);
    background:rgba(12,14,18,.96);
    color:#f3f4f8;
    box-shadow:0 18px 40px rgba(0,0,0,.45);
    display:flex;
    gap:.8rem;
    align-items:flex-start;
    z-index:2400;
    opacity:0;
    transform:translateY(12px);
    transition:opacity .2s ease, transform .2s ease;
  }
  .cookie-notice[hidden]{ display:none; }
  .cookie-notice--visible{ opacity:1; transform:translateY(0); }
  .cookie-notice__body{ flex:1; display:flex; flex-direction:column; gap:.6rem; }
  .cookie-notice__title{ font-weight:800; letter-spacing:.01em; margin:0; font-size:1rem; }
  .cookie-notice__text{ margin:0; color:rgba(243,244,248,.78); font-size:.95rem; line-height:1.5; }
  .cookie-notice__actions{ display:flex; align-items:center; gap:.6rem; flex-wrap:wrap; }
  .cookie-notice__btn{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.5rem .9rem; border-radius:.6rem; border:1px solid rgba(255,255,255,.18);
    background:#fff; color:#0b0d12; font-weight:800; cursor:pointer;
  }
  .cookie-notice__link{
    color:#fff; text-decoration:none; font-weight:700; font-size:.92rem;
  }
  .cookie-notice__link:hover{ text-decoration:underline; }
  .cookie-notice__close{
    border:1px solid rgba(255,255,255,.18);
    background:transparent;
    color:#fff;
    width:30px; height:30px;
    border-radius:8px;
    cursor:pointer;
    line-height:1;
  }
  .cookie-notice__close:hover{ background:rgba(255,255,255,.08); }
  .cookie-notice__close:focus-visible,
  .cookie-notice__btn:focus-visible,
  .cookie-notice__link:focus-visible{
    outline:2px solid #fff;
    outline-offset:2px;
  }
  @media (max-width:640px){
    .cookie-notice{ left:12px; right:12px; max-width:none; }
    .cookie-notice__actions{ flex-direction:column; align-items:flex-start; }
    .cookie-notice__btn{ width:100%; }
  }
</style>

<div id="cookieNotice" class="cookie-notice" role="dialog" aria-live="polite" aria-label="Cookie notice" hidden>
  <div class="cookie-notice__body">
    <p class="cookie-notice__title">Cookies, quick heads-up</p>
    <p class="cookie-notice__text">We use cookies to keep the site running smoothly and remember your preferences.</p>
    <div class="cookie-notice__actions">
      <a class="cookie-notice__link" href="{% url 'legal-terms' %}">Learn more</a>
      <button type="button" class="cookie-notice__btn" data-cookie-dismiss>Got it</button>
    </div>
  </div>
  <button type="button" class="cookie-notice__close" data-cookie-dismiss aria-label="Dismiss cookie notice">x</button>
</div>

<script id="cookie-notice-js">
(function () {
  const notice = document.getElementById('cookieNotice');
  if (!notice) return;

  const dismissers = notice.querySelectorAll('[data-cookie-dismiss]');
  const storageKey = 'bgm:cookie-consent:v1';
  const cookieKey = 'bgm_cookie_consent_v1';
  const cookiePattern = new RegExp('(?:^|; )' + cookieKey.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\$&') + '=([^;]+)');

  const hasConsent = () => {
    try { if (window.localStorage.getItem(storageKey) === 'dismissed') return true; } catch (_) {}
    const m = document.cookie.match(cookiePattern);
    return m ? m[1] === 'dismissed' : false;
  };

  const persist = () => {
    try { window.localStorage.setItem(storageKey, 'dismissed'); } catch (_) {}
    const expires = new Date(Date.now() + 1000 * 60 * 60 * 24 * 365).toUTCString();
    document.cookie = `${cookieKey}=dismissed; expires=${expires}; path=/; SameSite=Lax`;
  };

  if (hasConsent()) return;

  notice.removeAttribute('hidden');
  requestAnimationFrame(() => notice.classList.add('cookie-notice--visible'));

  const close = () => {
    notice.classList.remove('cookie-notice--visible');
    persist();
    setTimeout(() => notice.setAttribute('hidden', ''), 220);
  };

  dismissers.forEach(btn => btn.addEventListener('click', close));
})();
</script>
