{% extends "base_site.html" %}
{% load static dealer_extras %}

{% block marketing_meta %}
  {% with meta_title="BGM Store — Services Catalog" meta_description="Explore curated service packages, pricing, and availability direct from BGM." meta_section="store" %}
    {% include "includes/marketing_head.html" %}
  {% endwith %}
{% endblock %}

{% block content %}
<section class="section">
  <div class="container">
    <h1 class="section__title">BGM Store</h1>
    <p class="section__desc">Catalog of parts and upgrades.</p>

    {% for category in categories %}
      <h2 style="margin-top:1.5rem">{{ category.name }}</h2>
      <div class="grid grid--cards">
        {% for product in category.product_set.all %}
          <article class="card">
            {% if product.image %}
              <img class="card__img" src="{{ product.image.url }}" alt="{{ product.name }}">
            {% endif %}
            <h3 style="margin-top:.6rem">{{ product.name }}</h3>
            <p class="section__desc">{{ product.description|truncatewords:20 }}</p>
            {% if product.contact_for_estimate %}
              <p><strong>Contact for estimate</strong></p>
            {% else %}
              <p>
                <strong>{% if product.has_option_price_overrides %}From {% endif %}{{ product.display_price|money }}</strong>
                {% if dealer_portal.show_discount %}
                  <span style="display:block;color:var(--muted);font-size:.9rem;">
                    Dealer {{ product.display_price|dealer_price:dealer_portal.discount_percent|money }} · Save {{ product.display_price|dealer_savings:dealer_portal.discount_percent|money }}
                  </span>
                {% endif %}
              </p>
            {% endif %}
            <a class="btn btn--primary" href="#">Order</a>
          </article>
        {% empty %}
          <p class="section__desc">No products in this category yet.</p>
        {% endfor %}
      </div>
    {% empty %}
      <p>Categories have not been created yet.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}
