
{% load static dealer_extras %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ home_copy.meta_title|default:"BGM — Performance Builds & VIP Service" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% with meta_title=home_copy.meta_title|default:"BGM — Performance Builds & VIP Service" meta_description=home_copy.meta_description|default:"Performance-driven builds, detailing, tuning, and a curated product catalog by BGM in Calgary." meta_image=hero_carousel.0.src|default:hero_media.src meta_section="home" %}
    {% include "includes/marketing_head.html" %}
  {% endwith %}
  {% if font_settings.preload_fonts %}
    {% for font in font_settings.preload_fonts %}
      <link rel="preload" href="{{ font.url }}" as="font" type="{{ font.mime_type|default:'font/ttf' }}" crossorigin>
    {% endfor %}
  {% endif %}

  <style>
    :root{
      --bg:#000; --fg:#fff; --muted:rgba(255,255,255,.72); --muted-2:rgba(255,255,255,.55);
      --line:rgba(255,255,255,.12); --panel:#0E0E0E; --panel-2:#131313;
      --accent:#d50000; --accent-2:#ff1a1a; --ok:#17d45b;
      --radius-lg:1.25rem; --radius-sm:.6rem; --shadow:0 10px 30px rgba(0,0,0,.45);
      --container:clamp(320px,92vw,1280px);
      --site-header-height:72px;
      --site-header-toggle-size:46px;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px;scroll-behavior:smooth}
    body{background:var(--bg);color:var(--fg);font-family:var(--font-body);line-height:1.55;}
    img{max-width:100%;display:block}
    .container{width:var(--container);margin-inline:auto;padding-inline:1rem}
    a{color:inherit;text-decoration:none}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}

    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.6em;padding:.78rem 1.15rem;border-radius:var(--radius-sm);
      font-weight:800;letter-spacing:.3px;cursor:pointer;transition:.24s;border:1px solid transparent;user-select:none}
    .btn:disabled{opacity:.45;cursor:not-allowed}
    .btn--primary{background:var(--accent);color:#fff}
    .btn--primary:hover{transform:translateY(-2px);box-shadow:0 12px 22px rgba(213,0,0,.25)}
    .btn--ghost{background:transparent;border-color:var(--line);color:var(--fg)}
    .btn--ghost:hover{border-color:var(--accent);color:var(--accent)}
    .btn--link{padding:0;border:none;background:transparent;color:var(--accent)}
    .badge{display:inline-block;font-size:.78rem;padding:.15rem .55rem;border-radius:999px;background:var(--accent);color:#fff}
    .price{display:flex;gap:.45rem;align-items:baseline;}
    .price--stacked{flex-direction:column;align-items:flex-start;gap:.25rem;}
    .price__retail-row{display:flex;gap:.4rem;align-items:baseline;}
    .price__dealer-row{display:inline-flex;gap:.35rem;align-items:baseline;background:rgba(213,0,0,.12);border:1px solid rgba(213,0,0,.35);border-radius:.5rem;padding:.2rem .45rem;}
    .price__hint{font-size:.75rem;font-weight:800;color:var(--muted-2);text-transform:uppercase;letter-spacing:.08em;}
    .price__save{font-size:.75rem;color:var(--muted-2);}

    /* Header (desktop intact) */
    .site-header{position:sticky;top:0;z-index:1000;background:#000;border-bottom:1px solid var(--line)}
    .site-header__inner{display:flex;align-items:center;gap:1.25rem;justify-content:space-between;padding:.7rem 0}
    .brand{display:flex;align-items:baseline;gap:.9rem;font-weight:900;letter-spacing:.5px}
    .brand__logo{all:unset;display:inline-flex;gap:.5rem;line-height:1;letter-spacing:.06em;font-size:1rem}
    .brand__word--white{color:#fff}.brand__word--red{color:#d50000}
    .brand__tagline{margin-left:1.1rem;white-space:nowrap;font-size:.82rem;font-weight:800;letter-spacing:.14em;color:rgba(255,255,255,.72)}
    nav ul{display:flex;align-items:center;gap:1.4rem;list-style:none}
    nav a{display:inline-flex;align-items:center;gap:.45rem;line-height:1;text-transform:uppercase;font-weight:800;letter-spacing:.08em;font-size:.82rem;color:rgba(255,255,255,.78)}
    nav a:hover,nav a[aria-current="page"]{color:#fff}
    nav .btn,nav .btn--ghost{padding:0;border:none;background:none}

    .hero{position:relative;overflow:hidden;background:transparent}
    .hero__inner{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;padding:clamp(1.6rem,4.5vw,3.6rem) 0;align-items:center}
    .hero__title{font-size:clamp(2rem,4.6vw,3.4rem);font-weight:900;line-height:1.15}
    .hero__lead{color:var(--muted);font-size:clamp(1rem,1.5vw,1.15rem);max-width:54ch;margin-top:1rem}
    .hero__cta{display:flex;gap:.8rem;margin-top:1.35rem;flex-wrap:wrap}
    .hero__logo-block{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:.85rem;
      margin:0 auto 1.1rem;
      width:100%;
    }
    .hero__logo{
      width:clamp(110px, var(--hero-logo-size, 180px), 240px);
      height:clamp(110px, var(--hero-logo-size, 180px), 240px);
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:var(--hero-logo-bg, #0b0b0b);
      box-shadow:var(--shadow);
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
      --hero-logo-backdrop:none;
    }
    .hero__logo--bg-dark{--hero-logo-bg:#0b0b0b;}
    .hero__logo--bg-light{--hero-logo-bg:#f3f3f3;border-color:rgba(0,0,0,.2);}
    .hero__logo--bg-light .hero__logo-text{color:#111;}
    .hero__logo--bg-accent{
      --hero-logo-bg:radial-gradient(circle at 30% 30%, rgba(255,255,255,.25), rgba(213,0,0,.45)), #2a0000;
      border-color:rgba(255,255,255,.22);
    }
    .hero__logo--bg-transparent{
      --hero-logo-bg:transparent;
      border-color:rgba(255,255,255,.28);
      box-shadow:none;
    }
    .hero__logo--no-ring{
      border-color:transparent;
      box-shadow:none;
    }
    .hero__logo--backdrop::before{
      content:"";
      position:absolute;
      inset:0;
      background-image:var(--hero-logo-backdrop);
      background-size:cover;
      background-position:center;
      opacity:.78;
      filter:saturate(1.05) contrast(1.05);
    }
    .hero__logo--backdrop::after{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 30% 25%, rgba(255,255,255,.25), transparent 55%);
      opacity:.6;
    }
    .hero__logo img{
      position:relative;
      width:64%;
      height:64%;
      object-fit:contain;
      z-index:1;
      filter:drop-shadow(0 8px 18px rgba(0,0,0,.55));
    }
    .hero__logo-text{
      position:relative;
      z-index:1;
      font-weight:900;
      letter-spacing:.22em;
      font-size:.95rem;
      text-transform:uppercase;
      color:#fff;
    }
    .hero__logo-photo{
      width:min(var(--hero-logo-photo-width, 440px), 100%);
      height:var(--hero-logo-photo-height, auto);
      border-radius:1.2rem;
      overflow:hidden;
      border:1px solid var(--line);
      background:linear-gradient(180deg,#0b0b0b,#0a0a0a);
      box-shadow:var(--shadow);
    }
    .hero__logo-photo img{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
    }
    .stat{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);border-radius:var(--radius-lg);padding:1rem 1.1rem;box-shadow:var(--shadow)}
    .stat b{font-size:1.35rem}
    .frame{border-radius:1.2rem;border:1px solid var(--line);background:linear-gradient(180deg,#0b0b0b,#0a0a0a);box-shadow:inset 0 0 0 1px rgba(255,255,255,.02),0 14px 28px rgba(0,0,0,.45);aspect-ratio:16/10;display:flex;align-items:center;justify-content:center;color:var(--muted-2)}
    .hero__media.frame{aspect-ratio:var(--hero-media-aspect, 18/9);height:var(--hero-media-height, auto);}
    .frame--media{position:relative;overflow:hidden}
    .frame--media img{width:100%;height:100%;object-fit:cover;display:block;filter:contrast(1.05)}
    .frame__play{position:absolute;inset:0;margin:auto;width:72px;height:72px;border-radius:999px;display:grid;place-items:center;font-size:28px;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);border:1px solid rgba(255,255,255,.18);color:#fff}
    .hero__media{position:relative;width:min(100%, var(--hero-media-width, 100%));max-width:100%;justify-self:end;}
    .hero__disclaimer{position:absolute;left:1.1rem;bottom:1.1rem;padding:.35rem .9rem;border-radius:.85rem;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.6);color:rgba(255,255,255,.82);font-size:.72rem;letter-spacing:.12em;text-transform:uppercase;display:inline-flex;align-items:center;gap:.45rem;backdrop-filter:blur(6px)}
    .hero__disclaimer::before{content:"";width:18px;height:1px;background:rgba(255,255,255,.45);flex-shrink:0}
    .hero__media--carousel{display:block;}
    .hero__slides{position:relative;width:100%;height:100%;}
    .hero__slide{position:absolute;inset:0;opacity:0;transition:opacity .45s ease;}
    .hero__slide.is-active{opacity:1;}
    .hero__media--carousel .hero__disclaimer{z-index:3;}
    .hero__carousel-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:42px;
      height:42px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.45);
      backdrop-filter:blur(4px);
      color:#fff;
      display:grid;
      place-items:center;
      cursor:pointer;
      transition:.2s ease;
      z-index:3;
    }
    .hero__carousel-btn:hover{border-color:rgba(213,0,0,.6);transform:translateY(-50%) scale(1.03);}
    .hero__carousel-btn svg{width:22px;height:22px;display:block;}
    .hero__carousel-btn--prev{left:.65rem;}
    .hero__carousel-btn--next{right:.65rem;}
    .hero__media--carousel[data-slides="1"] .hero__carousel-btn{display:none;}
    @media (max-width:900px){
      .hero__disclaimer{
        position:static;
        margin-top:.85rem;
        padding:.4rem .85rem;
        backdrop-filter:none;
        width:100%;
        max-width:100%;
        line-height:1.35;
        font-size:.72rem;
        display:-webkit-box;
        -webkit-line-clamp:2;
        -webkit-box-orient:vertical;
        overflow:hidden;
      }
      .hero__slides{height:auto;}
      .hero__slide{position:relative;opacity:1;display:none;}
      .hero__slide.is-active{display:block;}
      .hero__carousel-btn{width:38px;height:38px;}
    }

    .section{padding:clamp(2rem,6vw,4rem) 0;border-top:1px solid var(--line)}
    .section__head{display:flex;align-items:end;justify-content:space-between;margin-bottom:1.1rem;gap:1rem}
    .section__title{font-size:1.6rem;font-weight:900}
    .section__desc{color:var(--muted-2)}
    .kicker{color:var(--muted-2);font-weight:800;letter-spacing:.18em;text-transform:uppercase;font-size:.78rem}

    .filters{display:flex;flex-wrap:wrap;gap:.65rem;margin:1rem 0 1.25rem}
    .input,.select{background:var(--panel);border:1px solid var(--line);color:var(--fg);padding:.65rem .85rem;border-radius:.55rem;font:inherit;min-width:210px}

    .grid{display:grid;gap:1rem}
    .grid--services{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .grid--products{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
    .grid--products .card{height:100%}
    .grid--products .card > a{
      display:flex;
      flex-direction:column;
      gap:.5rem;
      flex:1;
    }
    .grid--gallery{grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}

    .home-gallery{margin:1rem 0 1.6rem}
    .home-gallery__head{margin-bottom:1rem}
    .gallery-card{
      position:relative;
      display:block;
      border-radius:1rem;
      overflow:hidden;
      border:1px solid var(--line);
      background:linear-gradient(180deg,var(--panel),var(--panel-2));
      box-shadow:var(--shadow);
      transition:transform .22s ease,border-color .22s ease,box-shadow .22s ease;
    }
    .gallery-card:hover{transform:translateY(-3px);border-color:rgba(213,0,0,.45)}
    .gallery-card:focus-visible{outline:2px solid var(--accent);outline-offset:4px}
    .gallery-card .frame{
      border:none;
      border-radius:0;
      box-shadow:none;
      aspect-ratio:4/3;
      background:#0b0b0b;
    }
    .gallery-card__meta{
      position:absolute;
      left:.8rem;
      right:.8rem;
      bottom:.8rem;
      display:flex;
      flex-direction:column;
      gap:.2rem;
      padding:.4rem .6rem;
      border-radius:.7rem;
      background:rgba(0,0,0,.6);
      border:1px solid rgba(255,255,255,.16);
      backdrop-filter:blur(6px);
    }
    .gallery-card__title{font-weight:800;font-size:.92rem}
    .gallery-card__caption{font-size:.78rem;color:rgba(255,255,255,.82)}

    .card{display:flex;flex-direction:column;gap:.75rem;padding:1rem;border-radius:1rem;background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);box-shadow:var(--shadow);transition:transform .22s ease}
    .card:hover{transform:translateY(-3px)}
    .card__img{position:relative;aspect-ratio:16/9;border-radius:.8rem;overflow:hidden;background:#0b0b0b;display:flex;align-items:center;justify-content:center;color:var(--muted-2);font-size:.95rem}
    .card__img img{width:100%;height:100%;object-fit:cover;display:block}
    .card__badge{position:absolute;left:.6rem;bottom:.6rem;font-size:.72rem;background:rgba(0,0,0,.55);color:#fff;border-radius:999px;padding:.18rem .55rem;border:1px solid rgba(255,255,255,.14);backdrop-filter: blur(4px) saturate(120%)}
    .card__head{display:flex;align-items:flex-start;gap:.5rem;flex-wrap:wrap}
    .card__head h3{flex:1 1 auto;min-width:0}
    .price{display:flex;gap:.5rem;align-items:baseline;flex-wrap:wrap;white-space:normal;max-width:100%}
    .card__head .price{margin-left:auto;text-align:right}
    .old{color:var(--muted-2);text-decoration:line-through}
    .dur{color:var(--muted-2);font-size:.92rem}
    .grid--services .card{height:100%}
    .grid--services .card__cta{margin-top:auto}
    .empty{color:var(--muted-2);font-style:italic;padding:1rem}

    .home-card-actions{
      display:flex;
      gap:.5rem;
      flex-wrap:wrap;
      margin-top:auto;
      padding-top:.4rem;
    }

    .tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}
    .tile{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);border-radius:1rem;padding:1rem}
    .tile__icon{font-size:1.4rem;color:var(--accent);margin-bottom:.25rem}
    .tile--link{display:flex;flex-direction:column;gap:.4rem;min-height:100%;transition:transform .25s ease,border-color .25s ease,box-shadow .25s ease}
    .tile--link .tile__cta{margin-top:.1rem;font-size:.85rem;letter-spacing:.08em;text-transform:uppercase;font-weight:800;color:var(--muted);display:inline-flex;align-items:center;gap:.35rem}
    .tile--link:hover,.tile--link:focus-visible{border-color:rgba(213,0,0,.65);box-shadow:0 12px 28px rgba(0,0,0,.45),0 0 20px rgba(213,0,0,.2);transform:translateY(-2px);outline:none}
    .tile--link:hover .tile__cta,.tile--link:focus-visible .tile__cta{color:var(--accent)}
    .reviews-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem;margin-top:1.1rem}
    .review-card{display:flex;flex-direction:column;gap:.6rem}
    .review-stars{font-size:.9rem;color:var(--accent-2);letter-spacing:.14em}
    .review-author{font-weight:800;color:rgba(255,255,255,.9);font-size:.95rem}

    details{background:var(--panel);border:1px solid var(--line);border-radius:.8rem;padding:.8rem}
    summary{cursor:pointer;font-weight:700}
    details p{margin-top:.5rem;color:var(--muted)}

    .site-footer{border-top:1px solid var(--line);padding:1.6rem 0;color:var(--muted-2);font-size:.95rem}
    .footer__grid{display:grid;grid-template-columns:1.2fr .8fr;gap:1rem}
    .footer__nav{display:flex;gap:.75rem;flex-wrap:wrap}

    .sk{height:140px;border-radius:.8rem;background:linear-gradient(90deg,#111,#151515,#111);background-size:200% 100%;animation:sh 1.1s ease-in-out infinite}
    .ph{width:100%;height:100%;background:linear-gradient(90deg,#111,#151515,#111);background-size:200% 100%;animation:sh 1.1s ease-in-out infinite}
    @keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}

    @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}

    /* Smoke layer */
    #bg{position:fixed;inset:0;z-index:0;pointer-events:none}
    #bg canvas{position:absolute;inset:0;width:100%;height:100%;display:block}
    /* Content above smoke */
    .site-header,.hero,main,.site-footer{position:relative;z-index:1}

    .site-header__inner{display:flex;align-items:center;justify-content:space-between;gap:1.25rem;padding:.7rem 0}
    @media (max-width:1200px){.brand__tagline{display:none !important}}

    /* Fonts */
    {% with fs=font_settings %}
    {% for font in fs.fonts %}
      {% if font.has_source %}
    @font-face{
      font-family:"{{ font.family }}";
      src:url("{{ font.url }}") format("{{ font.format|default:'truetype' }}");
      font-weight:{{ font.weight|default:"400" }};
      font-style:{{ font.style|default:"normal" }};
      font-display:{{ font.display|default:"swap" }};
    }
      {% endif %}
    {% endfor %}
    {% with body_stack=fs.body.stack|default:'"Inter", system-ui, sans-serif' %}
    {% with heading_stack=fs.heading.stack|default:'"Diesel", system-ui, sans-serif' %}
    {% with ui_stack=fs.ui.stack|default:body_stack %}
    :root{
      --font-body: {{ body_stack|safe }};
      --font-head: {{ heading_stack|safe }};
      --font-ui:   {{ ui_stack|safe }};
    }
    {% with body_styles=fs.styles.body heading_styles=fs.styles.heading ui_styles=fs.styles.ui %}
    {% if body_styles or heading_styles or ui_styles %}
    :root{
      {% if body_styles.size %}--font-body-size: {{ body_styles.size|escape }};{% endif %}
      {% if body_styles.line_height %}--font-body-line-height: {{ body_styles.line_height|escape }};{% endif %}
      {% if body_styles.weight %}--font-body-weight: {{ body_styles.weight|escape }};{% endif %}
      {% if body_styles.letter_spacing %}--font-body-letter-spacing: {{ body_styles.letter_spacing|escape }};{% endif %}
      {% if heading_styles.weight %}--font-head-weight: {{ heading_styles.weight|escape }};{% endif %}
      {% if heading_styles.letter_spacing %}--font-head-letter-spacing: {{ heading_styles.letter_spacing|escape }};{% endif %}
      {% if heading_styles.transform %}--font-head-transform: {{ heading_styles.transform|escape }};{% endif %}
      {% if ui_styles.weight %}--font-ui-weight: {{ ui_styles.weight|escape }};{% endif %}
      {% if ui_styles.letter_spacing %}--font-ui-letter-spacing: {{ ui_styles.letter_spacing|escape }};{% endif %}
      {% if ui_styles.transform %}--font-ui-transform: {{ ui_styles.transform|escape }};{% endif %}
    }
    {% if body_styles.size or body_styles.line_height or body_styles.weight or body_styles.letter_spacing %}
    body{
      {% if body_styles.size %}font-size: var(--font-body-size) !important;{% endif %}
      {% if body_styles.line_height %}line-height: var(--font-body-line-height) !important;{% endif %}
      {% if body_styles.weight %}font-weight: var(--font-body-weight) !important;{% endif %}
      {% if body_styles.letter_spacing %}letter-spacing: var(--font-body-letter-spacing) !important;{% endif %}
    }
    {% endif %}
    {% if heading_styles.weight or heading_styles.letter_spacing or heading_styles.transform %}
    h1,h2,h3,h4,h5,h6,.hero__title{
      {% if heading_styles.weight %}font-weight: var(--font-head-weight) !important;{% endif %}
      {% if heading_styles.letter_spacing %}letter-spacing: var(--font-head-letter-spacing) !important;{% endif %}
      {% if heading_styles.transform %}text-transform: var(--font-head-transform) !important;{% endif %}
    }
    {% endif %}
    {% if ui_styles.weight or ui_styles.letter_spacing or ui_styles.transform %}
    button,.btn,.badge,nav a,input,select,textarea,.site-header__toggle{
      {% if ui_styles.weight %}font-weight: var(--font-ui-weight) !important;{% endif %}
      {% if ui_styles.letter_spacing %}letter-spacing: var(--font-ui-letter-spacing) !important;{% endif %}
      {% if ui_styles.transform %}text-transform: var(--font-ui-transform) !important;{% endif %}
    }
    {% endif %}
    {% endif %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    html{ text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased; }
    body,button,input,select,textarea{ font-family:var(--font-body)!important }

    /* Headings and UI (keep Ford where appropriate, not in top bar) */
    h1,h2,h3,h4,h5,h6,.hero__title{font-family:var(--font-head)!important;letter-spacing:.01em;font-style:normal}
    .section__title{font-family:var(--font-body)!important;font-weight:900!important;font-size:clamp(1.9rem,2.8vw,2.25rem)!important;letter-spacing:.005em!important;line-height:1.2!important}
    .section__title,.hero__title{letter-spacing:.01em}
    .section__desc{font-size:clamp(1rem,1.4vw,1.06rem)!important;color:rgba(255,255,255,.86)!important}
    .kicker{
      color:rgba(255,255,255,.78)!important;
      font-family:var(--font-ui)!important;
    }
    .footer__nav a{
      font-family:var(--font-ui)!important;
      font-weight:700!important;
      letter-spacing:.02em!important;
      text-transform:none!important;
      color:rgba(255,255,255,.9)!important;
    }
    .footer__nav a:hover{color:#fff!important}

    /* Card text readability */
    .card h3{font-family:var(--font-body)!important;font-weight:900!important;font-size:1.08rem!important;letter-spacing:.01em!important;line-height:1.25!important;color:#fff!important}
    .card .muted,.card .dur{font-family:var(--font-body)!important;font-weight:400!important;font-size:.98rem!important;line-height:1.4!important;color:rgba(255,255,255,.86)!important}
    .price strong{font-family:var(--font-body)!important;font-weight:800!important}
    .card__badge,.badge{font-family:var(--font-ui)!important;font-weight:800!important;letter-spacing:.02em!important;text-transform:none!important}
    .btn{font-family:var(--font-ui)!important;font-weight:800!important;letter-spacing:.02em!important;text-transform:none!important;line-height:1.15!important;font-size:.98rem!important}
    .input,.select,.filters .input,.filters .select{font-family:var(--font-ui)!important;font-size:.95rem!important;line-height:1.2!important}
  </style>

  {% include "includes/site_notice_style.html" %}

  <!-- Top bar -->
  <style id="logo-to-diesel">
    .site-header .brand,
    .site-header .brand__logo,
    .site-header .brand__logo .brand__word{
      font-family:var(--topbar-brand-font, var(--font-head))!important;
      font-style:normal!important;
      font-weight:var(--topbar-brand-weight, 900)!important;
      text-transform:var(--topbar-brand-transform, uppercase)!important;
      letter-spacing:var(--topbar-brand-letter-spacing, .06em)!important;
      line-height:1!important;
    }
    .site-header .brand__logo{font-size:var(--topbar-brand-size, clamp(1.2rem,1.8vw,1.55rem))!important}
    .site-header .brand__tagline,
    .site-header nav a,
    .site-header nav .btn,
    .site-header nav .btn--ghost{
      font-family:var(--topbar-nav-font, var(--font-ui, var(--font-body)))!important;
      font-style:normal!important;
    }
  </style>

  <style id="belt-to-diesel">
    .site-header .brand__tagline,
    .site-header .belt{
      font-family:var(--topbar-nav-font, var(--font-ui, var(--font-body)))!important;
      font-weight:900!important;
      text-transform:uppercase!important;
      letter-spacing:.12em!important;
      line-height:1!important;
      color:rgba(255,255,255,.78)!important;
      font-size:clamp(.78rem,.95vw,.95rem)!important;
      white-space:nowrap!important;
    }
  </style>

  <!-- Mobile nav (Merch model) -->
  <style id="mobile-nav-v2">
    .sr-only{
      position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }
    .site-header__toggle{
      display:none;align-items:center;justify-content:center;
      width:var(--site-header-toggle-size);height:var(--site-header-toggle-size);
      border-radius:.85rem;border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);color:#fff;cursor:pointer;
      transition:transform .18s ease, background .18s ease, border-color .18s ease;
    }
    .site-header__toggle:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.28)}
    .site-header__toggle:focus-visible{outline:2px solid #fff;outline-offset:3px}
    .site-header__toggle-box{position:relative;width:20px;height:14px;display:block}
    .site-header__toggle-lines,
    .site-header__toggle-lines::before,
    .site-header__toggle-lines::after{
      content:"";position:absolute;left:0;width:100%;height:2px;border-radius:999px;background:currentColor;
      transition:transform .22s ease, opacity .22s ease, background .22s ease;
    }
    .site-header__toggle-lines{top:50%;transform:translateY(-50%)}
    .site-header__toggle-lines::before{top:-6px}
    .site-header__toggle-lines::after{top:6px}
    .site-header--open .site-header__toggle{background:rgba(255,255,255,.16);border-color:rgba(255,255,255,.38)}
    .site-header--open .site-header__toggle-lines{background:transparent}
    .site-header--open .site-header__toggle-lines::before{transform:translateY(6px) rotate(45deg)}
    .site-header--open .site-header__toggle-lines::after{transform:translateY(-6px) rotate(-45deg)}

    @media (max-width:960px){
      body.nav-open{overflow:hidden}
      .site-header{--site-header-height:max(62px,10vh)}
      .site-header .container{padding-inline:clamp(16px,4vw,24px)}
      .site-header__inner{display:grid;grid-template-columns:auto max-content;align-items:center;gap:clamp(12px,3vw,24px)}
      .site-header__toggle{display:inline-flex}

      .site-header nav{
        position:fixed;inset:0;padding-top:calc(var(--site-header-height) + 1rem);
        padding-inline:clamp(20px,6vw,36px);padding-bottom:clamp(28px,12vh,46px);
        background:rgba(5,5,5,.88);backdrop-filter:blur(18px) saturate(1.2);
        display:flex;align-items:flex-start;justify-content:flex-start;
        opacity:0;pointer-events:none;transform:translateY(-12px);
        transition:opacity .22s ease, transform .22s ease;z-index:3700;
        overflow-y:auto;-webkit-overflow-scrolling:touch;border-right:none;box-shadow:none;
      }
      .site-header nav ul{
        flex-direction:column;align-items:stretch;gap:.9rem;width:100%;margin:0;padding:0;list-style:none;
      }
      .site-header nav li{width:100%}
      .site-header nav a,.site-header nav .btn,.site-header nav .btn--ghost{
        width:100%;display:flex;align-items:center;justify-content:space-between;
        min-height:56px;padding:1.05rem 1.15rem;border-radius:1rem;
        background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);
        font-size:1.05rem;letter-spacing:.035em;box-shadow:0 8px 24px rgba(0,0,0,.35);
      }
      .site-header nav a:hover,
      .site-header nav a[aria-current="page"],
      .site-header nav .btn:hover{
        background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.22);color:#fff;
      }
      .brand__tagline{display:none !important}
      .site-header--open nav, body.nav-open .site-header nav{
        opacity:1;pointer-events:auto;transform:translateY(0);
      }
    }

    body.nav-open .contact-fab, .site-header--open ~ .contact-fab{display:none !important}
    .site-header nav a:focus{outline:none}
    .site-header nav a:focus-visible{outline:2px solid rgba(255,255,255,.6);outline-offset:3px;border-color:rgba(255,255,255,.22)}
  </style>

  <!-- Layering: keep header/nav above page content -->
  <style id="topbar-layering-fix">
    .site-header{z-index:3600 !important;}
    @media (max-width:960px){
      .site-header nav{z-index:3700 !important;}
    }
  </style>

  <!-- Mobile helpers -->
  <style id="mobile-lite">
    :root{ --mobile-break: 860px; }
    :where(.only-mobile){ display:none !important; }
    :where(.only-desktop){ display:contents !important; }
    @media (max-width: 860px){
      :where(.only-mobile){ display:block !important; }
      :where(.only-desktop){ display:none !important; }
    }

    .mobi-quick, #mobileServices, #mobileProducts{ margin-top:.9rem; }
    .mobi-photo-break{ margin:1.1rem 0; }
    .mobi-photo-break.frame{ aspect-ratio:16/9; }
    .mobi-actions{ display:grid; grid-template-columns:1fr 1fr; gap:.65rem; }
    .mobi-action{
      display:flex; flex-direction:column; gap:.25rem; padding:.9rem;
      border-radius:.85rem; border:1px solid var(--line);
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      text-decoration:none;
    }
    .mobi-action b{ font-weight:900; }
    .mobi-sub{ color:var(--muted-2); font-size:.95rem; }

    @media (max-width: 860px){
      #services .filters,
      #services #liveTitle, #services #liveGrid,
      #services #serverContent{ display:none !important; }
      #products .grid.grid--products{ display:none !important; }
    }
    @media (max-width: 640px){
      .mobi-photo-break.frame{ aspect-ratio:4/3; }
    }
  </style>

  <style id="hide-hero-image-mobile">
    @media (max-width: 860px){
      .hero__media{
        display:block !important;
        width:100%;
        order:2;
      }
      .hero__inner{ grid-template-columns: 1fr !important; }
      .hero__media.frame{
        aspect-ratio:auto;
        height:auto;
      }
      .hero__media img{
        width:100%;
        height:auto;
        max-height:42vh;
        border-radius:1rem;
      }
    }
  </style>
  <style id="home-mobile-density">
    @media (max-width: 860px){
      .container{ padding-inline:1.1rem; }
      .hero__inner{ gap:1.4rem; padding:2.6rem 0 2.1rem; }
      .hero__title{ font-size:clamp(2rem,7vw,2.7rem); line-height:1.1; }
      .hero__lead{ font-size:1rem; margin-top:.85rem; }
      .hero__cta{ flex-direction:column; align-items:stretch; }
      .hero__cta .btn{ width:100%; justify-content:center; }
      .hero__stats{ display:grid; grid-template-columns:1fr; gap:.45rem; width:100%; }
      .hero__stats br{ display:none; }
      .stat{
        width:100%;
        padding:.35rem 0;
        background:transparent;
        border:none;
        box-shadow:none;
        line-height:1.35;
      }
      .stat b{ display:inline; font-size:1rem; margin-right:.45rem; }
      .stat span{ display:inline; font-size:.95rem; }
      .mobi-actions{ grid-template-columns:1fr; }

      .section{ padding:2.2rem 0; }
      .section__head{ flex-direction:column; align-items:flex-start; gap:.6rem; }
      .section__head .btn{ width:100%; justify-content:center; }

      .filters{ flex-direction:column; align-items:stretch; }
      .input,.select{ width:100%; min-width:0; }
      .filters .btn{ width:100%; justify-content:center; }

      .grid--services,
      .grid--products,
      .grid--gallery,
      .tiles{ grid-template-columns:1fr; }

      .card{ padding:1rem; gap:.6rem; }
      .card__img{ aspect-ratio:4/3; }
      .card__head{ flex-direction:column; align-items:flex-start; }
      .card__head .price{ margin-left:0; text-align:left; }
      .card p.muted,
      .tile p.muted{
        display:-webkit-box;
        -webkit-line-clamp:2;
        -webkit-box-orient:vertical;
        overflow:hidden;
      }
      .card__cta .btn{ width:100%; justify-content:center; }
      .home-card-actions{ flex-direction:column; align-items:stretch; }
      .home-card-actions .btn,
      .home-card-actions form{ width:100%; }
      .home-card-actions form .btn{ width:100%; justify-content:center; }

      details{ padding:1rem; }
      summary{ font-size:1rem; }

      .cta-row{ flex-direction:column; align-items:flex-start; }
      .cta-row > div:last-child{ width:100%; display:flex; flex-direction:column; gap:.6rem; }
      .cta-row .btn{ width:100%; justify-content:center; }

      .footer__grid{ grid-template-columns:1fr; gap:.8rem; }
    }
    @media (max-width: 640px){
      .mobi-actions{ grid-template-columns:1fr; }
      .mobi-action{ padding:1rem; }
    }
  </style>
  <style id="mobile-sidebar-unified">
    @media (max-width:960px){
      body.nav-open{ overflow:hidden; }
      .site-header{ z-index:10000 !important; }
      .site-header__toggle{ position:relative; z-index:10002 !important; }
      .site-header nav{
        position:fixed !important;
        inset:0 !important;
        height:100dvh !important;
        padding-top:calc(var(--site-header-height) + 1rem) !important;
        padding-inline:clamp(20px,6vw,36px) !important;
        padding-bottom:calc(28px + env(safe-area-inset-bottom)) !important;
        background:rgba(6,6,6,.62) !important;
        -webkit-backdrop-filter:blur(24px) saturate(1.2) !important;
        backdrop-filter:blur(24px) saturate(1.2) !important;
        display:flex !important;
        align-items:flex-start !important;
        opacity:0;
        pointer-events:none;
        transform:translateY(-12px);
        transition:opacity .22s ease, transform .22s ease;
        overflow-y:auto !important;
        overscroll-behavior:contain;
        z-index:10001 !important;
      }
      .site-header--open nav,
      body.nav-open .site-header nav,
      .site-header .site-header__toggle[aria-expanded="true"] ~ nav{
        opacity:1 !important;
        pointer-events:auto !important;
        transform:translateY(0) !important;
      }
      .site-header nav ul{
        flex-direction:column !important;
        align-items:stretch !important;
        gap:1rem !important;
        width:100% !important;
      }
      .site-header nav li{ width:100% !important; }
      .site-header nav a,
      .site-header nav .btn,
      .site-header nav .btn--ghost{
        width:100% !important;
        min-height:56px;
        padding:1.1rem 1.2rem !important;
        border-radius:1rem !important;
        background:rgba(255,255,255,.05) !important;
        border:1px solid rgba(255,255,255,.12) !important;
        display:flex !important;
        align-items:center !important;
        justify-content:space-between !important;
      }
    }
    body.nav-open .contact-fab{ display:none !important; }
  </style>
  {% if layout_styles %}
  <style>
    {{ layout_styles|safe }}
  </style>
  {% endif %}
</head>

<body>
  {% include "includes/marketing_body.html" %}
  {% include "includes/site_notice_markup.html" with site_notice_version="offer-v1" %}
  {% include "includes/topbar_client_v3.html" %}

  {% if page_sections %}
    {% include "sections/render_sections.html" %}
  {% else %}

  <div id="bg"></div>

  <a href="#main" class="visually-hidden">{{ home_copy.skip_to_main_label }}</a>

  <section class="hero" id="top">
    {% if home_copy.hero_logo or home_copy.hero_logo_backdrop %}
      {% with logo_layout=home_copy.hero_logo_layout|default:"overlay" logo_bg=home_copy.hero_logo_bg_style|default:"dark" %}
        <div class="container">
          <div class="hero__logo-block hero__logo-block--{{ logo_layout }}" style="--hero-logo-size: {{ home_copy.hero_logo_size|default:180 }}px;">
            <div class="hero__logo hero__logo--bg-{{ logo_bg }}{% if not home_copy.hero_logo_show_ring %} hero__logo--no-ring{% endif %}{% if home_copy.hero_logo_backdrop and logo_layout == 'overlay' %} hero__logo--backdrop{% endif %}"{% if home_copy.hero_logo_backdrop and logo_layout == 'overlay' %} style="--hero-logo-backdrop:url('{{ home_copy.hero_logo_backdrop.url }}')"{% endif %}>
              {% if home_copy.hero_logo %}
                <img src="{{ home_copy.hero_logo.url }}" alt="{{ home_copy.hero_logo_alt }}"{% if not home_copy.hero_logo_alt %} aria-hidden="true"{% endif %} loading="lazy" decoding="async">
              {% else %}
                <span class="hero__logo-text">BGM</span>
              {% endif %}
            </div>
            {% if home_copy.hero_logo_backdrop and logo_layout == 'stacked' %}
              <div class="hero__logo-photo"{% if home_copy.hero_logo_photo_width or home_copy.hero_logo_photo_height %} style="{% if home_copy.hero_logo_photo_width %}--hero-logo-photo-width: {{ home_copy.hero_logo_photo_width }}px;{% endif %}{% if home_copy.hero_logo_photo_height %}--hero-logo-photo-height: {{ home_copy.hero_logo_photo_height }}px;{% endif %}"{% endif %}>
                <img src="{{ home_copy.hero_logo_backdrop.url }}" alt="" loading="lazy" decoding="async">
              </div>
            {% endif %}
          </div>
        </div>
      {% endwith %}
    {% endif %}
    <div class="container hero__inner">
      <div>
        <p class="kicker">{{ home_copy.hero_kicker }}</p>
        <h1 class="hero__title">{{ home_copy.hero_title }}</h1>
        <p class="hero__lead">{{ home_copy.hero_lead|safe }}</p>
        <div class="hero__cta">
          <a class="btn btn--primary" href="#services">{{ home_copy.hero_primary_cta_label }}</a>
          <a class="btn btn--ghost" href="{% url 'client-dashboard' %}#services">{{ home_copy.hero_secondary_cta_label }}</a>
        </div>

        <div class="hero__stats" style="display:flex;gap:.6rem;margin-top:1.2rem;flex-wrap:wrap">
          <div class="stat"><b>{{ home_copy.hero_stat_1_title }}</b><br><span class="muted">{{ home_copy.hero_stat_1_subtitle }}</span></div>
          <div class="stat"><b>{{ home_copy.hero_stat_2_title }}</b><br><span class="muted">{{ home_copy.hero_stat_2_subtitle }}</span></div>
          <div class="stat"><b>{{ home_copy.hero_stat_3_title }}</b><br><span class="muted">{{ home_copy.hero_stat_3_subtitle }}</span></div>
        </div>
      </div>

      <!-- Mobile quick actions -->
      <div class="mobi-quick only-mobile" aria-label="Quick actions">
        <div class="mobi-actions">
          <a class="mobi-action" href="{% url 'client-dashboard' %}#services">
            <b>{{ home_copy.hero_mobile_action_1_title }}</b><span class="mobi-sub">{{ home_copy.hero_mobile_action_1_subtitle }}</span>
          </a>
          <a class="mobi-action" href="{% url 'store' %}">
            <b>{{ home_copy.hero_mobile_action_2_title }}</b><span class="mobi-sub">{{ home_copy.hero_mobile_action_2_subtitle }}</span>
          </a>
          <a class="mobi-action" href="#contact">
            <b>{{ home_copy.hero_mobile_action_3_title }}</b><span class="mobi-sub">{{ home_copy.hero_mobile_action_3_subtitle }}</span>
          </a>
          <a class="mobi-action" href="{% url 'our-story' %}">
            <b>{{ home_copy.hero_mobile_action_4_title }}</b><span class="mobi-sub">{{ home_copy.hero_mobile_action_4_subtitle }}</span>
          </a>
        </div>
      </div>

      {% if hero_carousel %}
        <div class="frame frame--media hero__media hero__media--carousel"
             data-hero-carousel
             data-interval="8000"
             data-slides="{{ hero_carousel|length }}"
             aria-roledescription="carousel"
             aria-label="Hero image carousel"
             {% if home_copy.hero_media_width or home_copy.hero_media_height %}style="{% if home_copy.hero_media_width %}--hero-media-width: {{ home_copy.hero_media_width }}px;{% endif %}{% if home_copy.hero_media_height %}--hero-media-height: {{ home_copy.hero_media_height }}px;{% endif %}"{% endif %}>
          <div class="hero__slides" data-hero-slides>
            {% for slide in hero_carousel %}
              <div class="hero__slide{% if forloop.first %} is-active{% endif %}"
                   data-hero-slide
                   data-caption="{{ slide.caption|default:hero_media.caption|default:'Product may not appear exactly as shown.' }}">
                <img src="{{ slide.src }}"
                     alt="{{ slide.alt|default:hero_media.alt|default:'BGM hero' }}"
                     loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                     decoding="async">
              </div>
            {% endfor %}
          </div>
          <button class="hero__carousel-btn hero__carousel-btn--prev" type="button" aria-label="Previous image" data-hero-prev>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="hero__carousel-btn hero__carousel-btn--next" type="button" aria-label="Next image" data-hero-next>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <p class="hero__disclaimer" data-hero-caption>{{ hero_carousel.0.caption|default:hero_media.caption|default:"Product may not appear exactly as shown." }}</p>
        </div>
      {% else %}
        <div class="frame frame--media hero__media"{% if home_copy.hero_media_width or home_copy.hero_media_height %} style="{% if home_copy.hero_media_width %}--hero-media-width: {{ home_copy.hero_media_width }}px;{% endif %}{% if home_copy.hero_media_height %}--hero-media-height: {{ home_copy.hero_media_height }}px;{% endif %}"{% endif %}>
          <img src="{{ hero_media.src }}" alt="{{ hero_media.alt|default:'BGM hero' }}" loading="lazy" decoding="async">
          <p class="hero__disclaimer">{{ hero_media.caption|default:"Product may not appear exactly as shown." }}</p>
        </div>
      {% endif %}

    </div>
  </section>

  <main id="main">
    <div class="container only-mobile" aria-label="Featured build">
      <div class="frame frame--media mobi-photo-break">
        <img src="{% static 'img/hero-services.jpg' %}" alt="Service bay detail" loading="lazy" decoding="async">
      </div>
    </div>
    <!-- ========================= SERVICES on Home (limit 8) ========================= -->
    <section id="services" class="section">
      <div class="container">
        <div class="section__head">
          <div>
            <h2 class="section__title">{{ home_copy.services_title }}</h2>
            <p class="section__desc">{{ home_copy.services_desc|safe }}</p>
          </div>
          <div><a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">{{ home_copy.services_cta_label }}</a></div>
        </div>

        <div class="home-gallery" aria-label="{{ home_copy.gallery_title }}">
          <div class="section__head home-gallery__head">
            <div>
              <h3 class="section__title">{{ home_copy.gallery_title }}</h3>
              <p class="section__desc">{{ home_copy.gallery_desc|safe }}</p>
            </div>
            <div><a class="btn btn--ghost" href="{{ home_gallery_url }}">{{ home_copy.gallery_cta_label }}</a></div>
          </div>
          <div class="grid grid--gallery">
            {% for item in home_gallery_items %}
              <a class="gallery-card" href="{{ item.url }}" aria-label="{{ item.title|default:home_copy.gallery_cta_label }}">
                <div class="frame frame--media">
                  <img src="{{ item.src }}" alt="{{ item.alt }}" loading="lazy" decoding="async">
                </div>
                {% if item.title or item.caption %}
                  <div class="gallery-card__meta">
                    {% if item.title %}<span class="gallery-card__title">{{ item.title }}</span>{% endif %}
                    {% if item.caption %}<span class="gallery-card__caption">{{ item.caption|truncatewords:10 }}</span>{% endif %}
                  </div>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        </div>

        <!-- Mobile services lite -->
        <div id="mobileServices" class="only-mobile" aria-labelledby="servicesMobileTitle">
          <h3 id="servicesMobileTitle" class="kicker">{{ home_copy.services_mobile_kicker }}</h3>
          <div class="mobi-actions" style="margin-bottom:.6rem">
            <a class="mobi-action" href="{% url 'client-dashboard' %}?q=fabrication#services">
              <b>{{ home_copy.services_mobile_action_1_title }}</b><span class="mobi-sub">{{ home_copy.services_mobile_action_1_subtitle }}</span>
            </a>
            <a class="mobi-action" href="{% url 'client-dashboard' %}?q=suspension#services">
              <b>{{ home_copy.services_mobile_action_2_title }}</b><span class="mobi-sub">{{ home_copy.services_mobile_action_2_subtitle }}</span>
            </a>
            <a class="mobi-action" href="{% url 'client-dashboard' %}?q=tuning#services">
              <b>{{ home_copy.services_mobile_action_3_title }}</b><span class="mobi-sub">{{ home_copy.services_mobile_action_3_subtitle }}</span>
            </a>
            <a class="mobi-action" href="{% url 'client-dashboard' %}?q=coating#services">
              <b>{{ home_copy.services_mobile_action_4_title }}</b><span class="mobi-sub">{{ home_copy.services_mobile_action_4_subtitle }}</span>
            </a>
          </div>
          <form class="filters" role="search" method="get" action="{% url 'client-dashboard' %}">
            <input class="input" type="search" name="q" placeholder="{{ home_copy.services_search_placeholder }}" value="{{ q|default:'' }}">
            <button class="btn btn--ghost" type="submit">{{ home_copy.services_search_button_label }}</button>
          </form>
        </div>

        <!-- Filters -->
        <form class="filters" role="search" method="get" action="{% url 'client-dashboard' %}">
          <input class="input" type="search" name="q" placeholder="{{ home_copy.services_search_placeholder }}" value="{{ q|default:'' }}">
          <select class="select" name="cat" aria-label="Category">
            <option value="">{{ home_copy.services_filter_all_categories_label }}</option>
            {% for c in filter_categories %}
              <option value="{{ c.id }}" {% if active_category == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
          </select>
          <button class="btn btn--ghost" type="submit">{{ home_copy.services_search_button_label }}</button>
          {% if q or active_category %}
            <a class="btn btn--link" href="{% url 'client-dashboard' %}#services">{{ home_copy.services_reset_filters_label }}</a>
          {% endif %}
        </form>

        <!-- Live search -->
        <h3 id="liveTitle" class="kicker" style="display:none">{{ home_copy.services_live_results_label }}</h3>
        <div id="liveGrid" class="grid grid--services" style="display:none"></div>

        <!-- Server-rendered -->
        <div id="serverContent">
          {% if search_results %}
            <h3 class="kicker" style="margin:.5rem 0 1rem">{{ home_copy.services_results_label }}</h3>
            <div class="grid grid--services">
              {% for s in search_results|slice:":8" %}
                <article class="card">
                  <div class="card__img">
                    {% if s.image %}<img src="{{ s.image.url }}" alt="{{ s.name }}" loading="lazy" decoding="async">{% else %}<div class="ph" aria-hidden="true"></div>{% endif %}
                    {% if s.category %}<span class="card__badge">{{ s.category.name }}</span>{% endif %}
                  </div>
                  <div class="card__head">
                    <h3 style="font-weight:900">{{ s.name }}</h3>
                    <div class="price">
                      {% if s.contact_for_estimate %}
                        <strong>{{ home_copy.contact_for_estimate_label }}</strong>
                        {% if s.estimate_from_price %}
                          <span class="price__hint">{{ home_copy.from_label }} {{ s.estimate_from_price|money }}</span>
                        {% endif %}
                      {% else %}
                        {% with disc=s.get_active_discount %}
                          {% if disc %}
                            <span class="old">{{ s.base_price|money }}</span>
                            <strong>{{ s.get_discounted_price|money }}</strong>
                            <span class="badge">-{{ disc.discount_percent|floatformat:0 }}%</span>
                          {% else %}
                            <strong>{{ s.base_price|money }}</strong>
                          {% endif %}
                        {% endwith %}
                      {% endif %}
                    </div>
                  </div>
                  {% if s.description %}<p class="muted">{{ s.description|truncatewords:26 }}</p>{% endif %}
                  {% if s.duration_min %}
                    <div class="dur">{{ home_copy.services_duration_prefix }} {{ s.duration_min }} {{ home_copy.services_duration_suffix }}</div>
                  {% endif %}
                  <div class="card__cta">
                    <a class="btn btn--primary" href="{% url 'client-dashboard' %}?book={{ s.id }}#services">{{ home_copy.services_book_now_label }}</a>
                  </div>
                </article>
              {% empty %}
                <div class="empty">{{ home_copy.services_no_results_label }}</div>
              {% endfor %}
            </div>
            <hr style="margin:1.5rem 0;border:0;border-top:1px solid var(--line)">
          {% endif %}

          {% if home_services %}
            <h3 class="kicker" style="margin:.5rem 0 1rem">{{ home_copy.services_featured_label }}</h3>
            <div class="grid grid--services">
              {% for s in home_services|slice:":8" %}
                <article class="card">
                  <div class="card__img">
                    {% if s.image %}<img src="{{ s.image.url }}" alt="{{ s.name }}" loading="lazy" decoding="async">{% else %}<div class="ph" aria-hidden="true"></div>{% endif %}
                    {% if s.category %}<span class="card__badge">{{ s.category.name }}</span>{% endif %}
                  </div>
                  <div class="card__head">
                    <h3 style="font-weight:900">{{ s.name }}</h3>
                    <div class="price">
                      {% if s.contact_for_estimate %}
                        <strong>{{ home_copy.contact_for_estimate_label }}</strong>
                        {% if s.estimate_from_price %}
                          <span class="price__hint">{{ home_copy.from_label }} {{ s.estimate_from_price|money }}</span>
                        {% endif %}
                      {% else %}
                        {% with disc=s.get_active_discount %}
                          {% if disc %}
                            <span class="old">{{ s.base_price|money }}</span>
                            <strong>{{ s.get_discounted_price|money }}</strong>
                            <span class="badge">-{{ disc.discount_percent|floatformat:0 }}%</span>
                          {% else %}
                            <strong>{{ s.base_price|money }}</strong>
                          {% endif %}
                        {% endwith %}
                      {% endif %}
                    </div>
                  </div>
                  {% if s.description %}<p class="muted">{{ s.description|truncatewords:26 }}</p>{% endif %}
                  {% if s.duration_min %}
                    <div class="dur">{{ home_copy.services_duration_prefix }} {{ s.duration_min }} {{ home_copy.services_duration_suffix }}</div>
                  {% endif %}
                  <div class="card__cta">
                    <a class="btn btn--primary" href="{% url 'client-dashboard' %}?book={{ s.id }}#services">{{ home_copy.services_book_now_label }}</a>
                  </div>
                </article>
              {% endfor %}
            </div>
          {% elif not search_results and not has_any_services %}
            <div class="empty">{{ home_copy.services_empty_label }}</div>
          {% endif %}
        </div>
      </div>
    </section>

    <div class="container only-mobile" aria-label="Featured parts">
      <div class="frame frame--media mobi-photo-break">
        <img src="{% static 'img/hero-products.jpg' %}" alt="Performance parts display" loading="lazy" decoding="async">
      </div>
    </div>

    <!-- ========================= PRODUCTS ========================= -->
    <section id="products" class="section">
      <div class="container">
        <div class="section__head">
          <div>
            <h2 class="section__title">{{ home_copy.products_title }}</h2>
            <p class="section__desc">{{ home_copy.products_desc }}</p>
          </div>
          <div><a class="btn btn--primary" href="{% url 'store' %}">{{ home_copy.products_cta_label }}</a></div>
        </div>

        <!-- Mobile products lite -->
        <div id="mobileProducts" class="only-mobile" aria-labelledby="productsMobileTitle">
          <h3 id="productsMobileTitle" class="kicker">{{ home_copy.products_mobile_kicker }}</h3>
          <div class="mobi-actions">
            <a class="mobi-action" href="{% url 'store' %}">
              <b>{{ home_copy.products_mobile_action_1_title }}</b><span class="mobi-sub">{{ home_copy.products_mobile_action_1_subtitle }}</span>
            </a>
            <a class="mobi-action" href="{% url 'merch' %}">
              <b>{{ home_copy.products_mobile_action_2_title }}</b><span class="mobi-sub">{{ home_copy.products_mobile_action_2_subtitle }}</span>
            </a>
          </div>
        </div>

        {% if home_products %}
          <div class="grid grid--products">
            {% for p in home_products|slice:":8" %}
              <article class="card">
                <a href="{% url 'store-product' slug=p.slug %}">
                  <div class="card__img">
                    {% if p.main_image %}<img src="{{ p.main_image_url }}" alt="{{ p.name }}" loading="lazy" decoding="async">
                    {% elif p.image %}<img src="{{ p.image.url }}" alt="{{ p.name }}" loading="lazy" decoding="async">
                    {% else %}<div class="ph" aria-hidden="true"></div>{% endif %}
                    {% if p.category %}<span class="card__badge">{{ p.category.display_name }}</span>{% endif %}
                  </div>
                  <div class="card__head" style="margin-top:.35rem">
                    <h3 style="font-weight:900">{{ p.name }}</h3>
                    <div class="price price--stacked">
                      {% if p.contact_for_estimate %}
                        <strong>{{ home_copy.contact_for_estimate_label }}</strong>
                        {% if p.estimate_from_price %}<span class="price__hint">{{ home_copy.from_label }} {{ p.estimate_from_price|money }}</span>{% endif %}
                      {% else %}
                        <div class="price__retail-row">
                          {% if p.has_option_price_overrides %}<span class="price__hint">{{ home_copy.from_label }}</span>{% endif %}
                          <strong>{{ p.display_price|money }}</strong>
                          {% if p.old_price %}<span class="old">{{ p.old_price|money }}</span>{% endif %}
                        </div>
                        {% if dealer_portal.show_discount %}
                          <div class="price__dealer-row">
                            <span class="price__hint">{{ home_copy.products_dealer_label }} {{ dealer_portal.discount_percent }}%</span>
                            <strong>{{ p.display_price|dealer_price:dealer_portal.discount_percent|money }}</strong>
                            <span class="price__save">{{ home_copy.products_save_label }} {{ p.display_price|dealer_savings:dealer_portal.discount_percent|money }}</span>
                          </div>
                        {% endif %}
                      {% endif %}
                    </div>
                  </div>
                  {% if p.short_description %}<p class="muted">{{ p.short_description|truncatewords:20 }}</p>{% endif %}
                </a>
                <div class="home-card-actions">
                  {% if p.contact_for_estimate %}
                    <a class="btn btn--primary" href="{% url 'home' %}#contact">{{ home_copy.products_contact_us_label }}</a>
                    <a class="btn btn--ghost" href="{% url 'store-product' slug=p.slug %}">{{ home_copy.products_view_label }}</a>
                  {% elif p.has_active_options %}
                    <a class="btn btn--primary" href="{% url 'store-product' slug=p.slug %}#product-options">{{ home_copy.products_select_options_label }}</a>
                    <a class="btn btn--ghost" href="{% url 'store-product' slug=p.slug %}">{{ home_copy.products_view_label }}</a>
                  {% else %}
                    <form method="post" action="{% url 'store-cart-add' slug=p.slug %}">{% csrf_token %}
                      <button class="btn btn--primary" type="submit">{{ home_copy.products_add_to_cart_label }}</button>
                    </form>
                    <a class="btn btn--ghost" href="{% url 'store-product' slug=p.slug %}">{{ home_copy.products_view_label }}</a>
                  {% endif %}
                </div>
              </article>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty">
            {{ home_copy.products_empty_label }} <a class="btn btn--link" href="{% url 'store' %}">{{ home_copy.products_empty_cta_label }}</a>
          </div>
        {% endif %}
      </div>
    </section>

    <!-- ========================= HOW IT WORKS ========================= -->
    <section class="section">
      <div class="container">
        <div class="section__head">
          <h2 class="section__title">{{ home_copy.how_title }}</h2>
          <p class="section__desc">{{ home_copy.how_desc }}</p>
        </div>
        <div class="tiles">
          <div class="tile"><div class="tile__icon">①</div><b>{{ home_copy.how_step_1_title }}</b><p class="muted">{{ home_copy.how_step_1_desc }}</p></div>
          <div class="tile"><div class="tile__icon">②</div><b>{{ home_copy.how_step_2_title }}</b><p class="muted">{{ home_copy.how_step_2_desc }}</p></div>
          <div class="tile"><div class="tile__icon">③</div><b>{{ home_copy.how_step_3_title }}</b><p class="muted">{{ home_copy.how_step_3_desc }}</p></div>
          <div class="tile"><div class="tile__icon">④</div><b>{{ home_copy.how_step_4_title }}</b><p class="muted">{{ home_copy.how_step_4_desc }}</p></div>
        </div>
      </div>
    </section>

    <!-- ========================= WHY BGM ========================= -->
    <section class="section">
      <div class="container">
        <div class="section__head">
          <h2 class="section__title">{{ home_copy.why_title }}</h2>
          <p class="section__desc">{{ home_copy.why_desc }}</p>
        </div>
        <div class="tiles">
          <div class="tile"><div class="tile__icon">★</div><b>{{ home_copy.why_tile_1_title }}</b><p class="muted">{{ home_copy.why_tile_1_desc }}</p></div>
          <div class="tile"><div class="tile__icon">⏱</div><b>{{ home_copy.why_tile_2_title }}</b><p class="muted">{{ home_copy.why_tile_2_desc }}</p></div>
          <div class="tile"><div class="tile__icon">🔒</div><b>{{ home_copy.why_tile_3_title }}</b><p class="muted">{{ home_copy.why_tile_3_desc }}</p></div>
          <a class="tile tile--link" href="{% url 'legal-terms' %}" aria-label="{{ home_copy.why_warranty_aria_label }}" title="{{ home_copy.why_warranty_title_attr }}">
            <div class="tile__icon">💬</div>
            <b>{{ home_copy.why_warranty_title }}</b>
            <p class="muted">{{ home_copy.why_warranty_desc }}</p>
            <span class="tile__cta">{{ home_copy.why_warranty_cta }}</span>
          </a>
        </div>
        {% if home_reviews %}
          <div class="reviews-grid" aria-label="Testimonials">
            {% for review in home_reviews %}
              <article class="tile review-card">
                <div class="review-stars" aria-hidden="true">
                  {% for _ in review.star_range %}★{% endfor %}
                </div>
                <p class="muted">&ldquo;{{ review.quote }}&rdquo;</p>
                <p class="review-author">
                  {{ review.reviewer_name }}{% if review.reviewer_title %} &mdash; {{ review.reviewer_title }}{% endif %}
                </p>
                <span class="sr-only">{{ review.rating }} star review</span>
              </article>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </section>

    <!-- ========================= FAQ ========================= -->
    <section class="section">
      <div class="container">
        <div class="section__head">
          <h2 class="section__title">{{ home_copy.faq_title }}</h2>
          <p class="section__desc">{{ home_copy.faq_desc }}</p>
        </div>
        <div class="grid">
          <details><summary>{{ home_copy.faq_1_question }}</summary><p>{{ home_copy.faq_1_answer }}</p></details>
          <details><summary>{{ home_copy.faq_2_question }}</summary><p>{{ home_copy.faq_2_answer }}</p></details>
          <details><summary>{{ home_copy.faq_3_question }}</summary><p>{{ home_copy.faq_3_answer }}</p></details>
        </div>
      </div>
    </section>

    <!-- ========================= FINAL CTA ========================= -->
    <section class="section" aria-labelledby="cta">
      <div class="container cta-row" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap">
        <div>
          <h2 id="cta" class="section__title">{{ home_copy.final_cta_title }}</h2>
          <p class="section__desc">{{ home_copy.final_cta_desc }}</p>
        </div>
        <div style="display:flex;gap:.6rem">
          <a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">{{ home_copy.final_cta_primary_label }}</a>
          {% if user.is_authenticated %}
            <a class="btn btn--ghost" href="{% url 'dashboard' %}">{{ home_copy.final_cta_secondary_auth_label }}</a>
          {% else %}
            <a class="btn btn--ghost" href="{% url 'login' %}?next={% url 'dashboard' %}">{{ home_copy.final_cta_secondary_guest_label }}</a>
          {% endif %}
        </div>
      </div>
    </section>
  </main>

  {% include "includes/site_footer.html" %}

  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="{% static 'admin/js/bgm-smoke.js' %}"></script>

  <!-- Live search -->
  <script>
  (function(){
    const qInput = document.querySelector('input[name="q"]');
    const catSel = document.querySelector('select[name="cat"]');
    const liveTitle = document.getElementById('liveTitle');
    const liveGrid  = document.getElementById('liveGrid');
    const server    = document.getElementById('serverContent');
    if(!qInput || !catSel) return;

    const currencyCode = "{{ currency.code }}";
    const currencySymbol = "{{ currency.symbol }}";
    const copy = {
      contactForEstimate: "{{ home_copy.contact_for_estimate_label|escapejs }}",
      fromLabel: "{{ home_copy.from_label|escapejs }}",
      durationPrefix: "{{ home_copy.services_duration_prefix|escapejs }}",
      durationSuffix: "{{ home_copy.services_duration_suffix|escapejs }}",
      bookNowLabel: "{{ home_copy.services_book_now_label|escapejs }}",
      nothingFoundLabel: "{{ home_copy.services_nothing_found_label|escapejs }}",
      failedLoadLabel: "{{ home_copy.services_failed_load_label|escapejs }}",
    };
    const bookingBaseUrl = "{% url 'client-dashboard' %}";
    const toBookingUrl = (serviceId) => {
      if (serviceId) {
        return `${bookingBaseUrl}?book=${encodeURIComponent(serviceId)}#services`;
      }
      return `${bookingBaseUrl}#services`;
    };

    const skel = (n=8)=> Array.from({length:n}).map(()=>'<div class="sk"></div>').join('');
    const showLive = ()=>{ liveTitle.style.display='block'; liveGrid.style.display='grid'; server.style.display='none'; }
    const hideLive = ()=>{ liveTitle.style.display='none'; liveGrid.style.display='none'; server.style.display='block'; }
    const esc = s => (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    const formatMoney = (val) => {
      const num = Number(val);
      let normalized = "";
      if (Number.isFinite(num)) {
        normalized = num.toFixed(2);
      } else if (typeof val === "string" && val.trim()) {
        normalized = val.trim();
      }
      if (!normalized) return "";
      const symbol = currencySymbol || "$";
      return currencyCode ? `${currencyCode} ${symbol}${normalized}` : `${symbol}${normalized}`;
    };

    function cardHTML(s){
      let price;
      if (s.contact_for_estimate){
        const fromVal = s.estimate_from_price ? formatMoney(s.estimate_from_price) : "";
        const hint = fromVal ? `<span class="price__hint">${esc(copy.fromLabel)} ${esc(fromVal)}</span>` : "";
        price = `<strong>${esc(copy.contactForEstimate)}</strong>${hint ? " " + hint : ""}`;
      } else {
        const hasDisc = Number.isFinite(+s.discount_percent) && +s.discount_percent>0;
        const base = formatMoney(s.base_price);
        if (hasDisc){
          price = `<span class="old">${esc(base)}</span> <strong>${esc(formatMoney(s.price))}</strong> <span class="badge">-${esc(String(s.discount_percent))}%</span>`;
        } else {
          const current = s.price || s.base_price;
          price = `<strong>${esc(formatMoney(current))}</strong>`;
        }
      }
      const media = s.image ? `<img src="${esc(s.image)}" alt="${esc(s.name)}" loading="lazy" decoding="async">` : `<div class="ph" aria-hidden="true"></div>`;
      const cat   = s.category ? `<span class="card__badge">${esc(s.category)}</span>` : '';
      const desc  = s.description ? `<p class="muted">${esc(s.description)}</p>` : '';
      const bookingHref = toBookingUrl(s.id);
      const rawDuration = s.duration_min;
      const durationValue = Number(rawDuration);
      const hasDuration = Number.isFinite(durationValue) && durationValue > 0;
      const durationBits = hasDuration
        ? [copy.durationPrefix, String(rawDuration), copy.durationSuffix]
            .filter(Boolean)
            .map(esc)
            .join(" ")
        : "";
      const durationHtml = durationBits ? `<div class="dur">${durationBits}</div>` : "";
      return `
        <article class="card">
          <div class="card__img">${media}${cat}</div>
          <div class="card__head">
            <h3 style="font-weight:900">${esc(s.name)}</h3>
            <div class="price">${price}</div>
          </div>
          ${desc}
          ${durationHtml}
          <div class="card__cta"><a class="btn btn--primary" href="${bookingHref}">${esc(copy.bookNowLabel)}</a></div>
        </article>`;
    }

    function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
    let aborter=null;
    async function fetchServices(q,cat){
      if(aborter) aborter.abort();
      aborter = new AbortController();
      const p=new URLSearchParams(); if(q) p.set('q',q); if(cat) p.set('cat',cat);
      const r=await fetch(`/accounts/api/services/search/?${p.toString()}`,{signal:aborter.signal,credentials:'same-origin'});
      if(!r.ok) throw new Error('Load error'); return r.json();
    }

    const run = debounce(async ()=>{
      const q=qInput.value.trim(), cat=catSel.value;
      if(!q && !cat){ hideLive(); return; }
      showLive(); liveGrid.innerHTML = skel(8);
      try{
        const data=await fetchServices(q,cat);
        const items=(data&&data.results)||[];
        liveGrid.innerHTML = items.length ? items.map(cardHTML).join('') : `<div class="empty">${esc(copy.nothingFoundLabel)}</div>`;
      }catch{ liveGrid.innerHTML = `<div class="empty">${esc(copy.failedLoadLabel)}</div>`; }
    },300);

    qInput.addEventListener('input', run);
    catSel.addEventListener('change', run);
  })();
  </script>

  <!-- Contact FAB + Modal -->
  <style id="contact-fab-css">
    :root{ --ink:#eaeaea; --line:rgba(255,255,255,.12); --red:var(--accent,#d50000); --red-dark:#b60000; --contact-font:var(--font-ui,var(--font-body)); }
    .contact-fab{
      position:fixed; right:22px; bottom:22px; z-index:2100;
      display:inline-flex; align-items:center; gap:.6em;
      padding:.9rem 1.15rem; border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg,var(--red) 0%,var(--red-dark) 100%);
      color:#fff; font-weight:900; letter-spacing:.02em; line-height:1;
      cursor:pointer; box-shadow:0 12px 26px rgba(213,0,0,.28), 0 0 26px rgba(213,0,0,.18);
      transition:.18s ease; font-family:var(--contact-font) !important; font-style:normal !important;
    }
    .contact-fab:hover{ transform:translateY(-2px); filter:saturate(1.05); }
    .contact-fab:focus-visible{ outline:2px solid #fff; outline-offset:3px; }
    .contact-fab svg{ width:20px; height:20px; fill:currentColor; opacity:.95; }

    .contact-modal{
      position:fixed; inset:0; z-index:2200; display:none;
      align-items:center; justify-content:center; padding:1rem;
      background:rgba(0,0,0,.65); backdrop-filter:blur(2px);
    }
    .contact-modal[open]{ display:flex; }
    .contact-dialog{
      width:min(560px,92vw);
      background:linear-gradient(180deg,#0c0c0c,#121212);
      border:1px solid var(--line); border-radius:1rem;
      padding:1.1rem 1.1rem .95rem; color:var(--ink);
      box-shadow:0 18px 44px rgba(0,0,0,.55), 0 0 32px rgba(213,0,0,.18);
      position:relative;
    }
    .contact-title{
      font-family:var(--font-head,"Diesel"),system-ui,sans-serif;
      font-weight:900; letter-spacing:.005em; line-height:1.15;
      font-size:1.6rem; margin:.2rem 2.2rem 1rem .2rem; color:#fff;
      text-transform:none;
    }
    .contact-close{
      position:absolute; right:12px; top:10px; width:36px; height:36px;
      border:1px solid var(--line); border-radius:.5rem; background:#0f0f0f;
      color:#bdbdbd; cursor:pointer; font-size:20px; line-height:1;
    }
    .contact-body{ display:grid; gap:.75rem; }
    .contact-row{
      display:flex; align-items:center; justify-content:space-between; gap:.6rem;
      background:rgba(255,255,255,.06); border:1px solid var(--line);
      border-radius:.7rem; padding:.7rem .8rem;
      font-family:var(--contact-font) !important; font-style:normal !important;
    }
    .contact-row a{ color:#fff; font-weight:800; text-decoration:none; }
    .contact-sub{ color:rgba(255,255,255,.72); font-size:.95rem; }
    .contact-actions{ display:flex; gap:.6rem; margin-top:.9rem; flex-wrap:wrap; }
    .contact-btn{
      display:inline-flex; align-items:center; gap:.5em; padding:.7rem 1rem; border-radius:.55rem;
      border:1px solid var(--line); background:#0f0f0f; color:#fff; cursor:pointer;
      font-family:var(--contact-font) !important; font-weight:800; font-style:normal !important;
    }
    .contact-btn:hover{ border-color:rgba(213,0,0,.45); box-shadow:0 0 16px rgba(213,0,0,.25); }

    body.no-contact-fab .contact-fab{ display:none !important; }

    @media (max-width:640px){
      .contact-fab{ right:14px; bottom:14px; }
      .contact-title{ font-size:1.45rem; }
    }
  </style>

  <button type="button" id="contactFab" class="contact-fab"
          aria-haspopup="dialog" aria-controls="contactModal" aria-expanded="false">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M6.6 10.8c1.5 2.9 3.7 5.1 6.6 6.6l2.2-2.2c.3-.3.8-.4 1.2-.3 1 .3 2.1.5 3.2.5.7 0 1.2.5 1.2 1.2v3.5c0 .7-.5 1.2-1.2 1.2C9.8 21.5 2.5 14.2 2.5 4.2c0-.7.5-1.2 1.2-1.2H7c.7 0 1.2.5 1.2 1.2 0 1.1.2 2.2.5 3.2.1.4 0 .9-.3 1.2L6.6 10.8z"/>
    </svg>
    {{ home_copy.contact_fab_label }}
  </button>

  <div id="contactModal" class="contact-modal" role="dialog" aria-modal="true" aria-labelledby="contactTitle">
    <div class="contact-dialog">
      <button class="contact-close" type="button" aria-label="Close">×</button>
      <h2 id="contactTitle" class="contact-title">{{ home_copy.contact_modal_title }}</h2>

      <div class="contact-body">
        <div class="contact-row">
          <div>
            <div><a href="mailto:support@badguymotors.com">support@badguymotors.com</a></div>
            <div class="contact-sub">{{ home_copy.contact_email_label }}</div>
          </div>
          <button class="contact-btn" data-copy="support@badguymotors.com" type="button">{{ home_copy.contact_copy_label }}</button>
        </div>

        <div class="contact-row">
          <div>
            <div><a href="tel:+14035250432">(403) 525-0432</a></div>
            <div class="contact-sub">{{ home_copy.contact_phone_label }}</div>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <a class="contact-btn" href="tel:+14035250432">{{ home_copy.contact_call_label }}</a>
            <button class="contact-btn" data-copy="+1 403 525 0432" type="button">{{ home_copy.contact_copy_label }}</button>
          </div>
        </div>

        <div class="contact-actions">
          <a class="contact-btn" href="mailto:support@badguymotors.com?subject=Inquiry%20from%20website">{{ home_copy.contact_write_email_label }}</a>
          <a class="contact-btn" href="sms:+14035250432">{{ home_copy.contact_text_label }}</a>
        </div>
      </div>
    </div>
  </div>

  {% include "includes/site_notice_script.html" %}

  <!-- Unified topbar behavior -->
  <script src="{% static 'js/topbar.js' %}"></script>

  <!-- Hero carousel -->
  <script id="hero-carousel-js">
  (function(){
    const carousels = document.querySelectorAll('[data-hero-carousel]');
    if (!carousels.length) return;
    const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    carousels.forEach((carousel) => {
      const slides = Array.from(carousel.querySelectorAll('[data-hero-slide]'));
      if (!slides.length) return;

      const captionEl = carousel.querySelector('[data-hero-caption]');
      const prevBtn = carousel.querySelector('[data-hero-prev]');
      const nextBtn = carousel.querySelector('[data-hero-next]');
      let index = slides.findIndex((slide) => slide.classList.contains('is-active'));
      if (index < 0) index = 0;

      slides.forEach((slide, idx) => {
        slide.setAttribute('aria-hidden', idx === index ? 'false' : 'true');
      });

      const setCaption = (slide) => {
        if (!captionEl) return;
        const caption = slide.getAttribute('data-caption') || captionEl.textContent;
        captionEl.textContent = caption;
      };

      const showSlide = (nextIndex) => {
        slides[index].classList.remove('is-active');
        slides[index].setAttribute('aria-hidden', 'true');
        index = (nextIndex + slides.length) % slides.length;
        const active = slides[index];
        active.classList.add('is-active');
        active.setAttribute('aria-hidden', 'false');
        setCaption(active);
      };

      let timer = null;
      const interval = parseInt(carousel.getAttribute('data-interval') || '8000', 10);

      const startTimer = () => {
        if (prefersReduced || slides.length < 2 || interval <= 0) return;
        timer = window.setInterval(() => showSlide(index + 1), interval);
      };
      const stopTimer = () => {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
      };
      const resetTimer = () => {
        stopTimer();
        startTimer();
      };

      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          showSlide(index - 1);
          resetTimer();
        });
      }
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          showSlide(index + 1);
          resetTimer();
        });
      }

      carousel.addEventListener('mouseenter', stopTimer);
      carousel.addEventListener('mouseleave', startTimer);
      carousel.addEventListener('focusin', stopTimer);
      carousel.addEventListener('focusout', startTimer);

      setCaption(slides[index]);
      startTimer();
    });
  })();
  </script>

  <!-- Contact modal bindings -->
  <script id="contact-fab-js">
  (function(){
    const fab   = document.getElementById('contactFab');
    const modal = document.getElementById('contactModal');
    const closeBtn = modal.querySelector('.contact-close');
    const copyLabel = "{{ home_copy.contact_copy_label|escapejs }}";
    const copySuccess = "{{ home_copy.contact_copy_success_label|escapejs }}";
    const copyFailed = "{{ home_copy.contact_copy_failed_label|escapejs }}";
    let lastFocus = null;

    function openModal(){
      lastFocus = document.activeElement;
      modal.setAttribute('open','');
      fab.setAttribute('aria-expanded','true');
      setTimeout(()=>closeBtn.focus(),0);
      document.addEventListener('keydown', onKey);
    }
    function closeModal(){
      modal.removeAttribute('open');
      fab.setAttribute('aria-expanded','false');
      if (lastFocus) lastFocus.focus();
      document.removeEventListener('keydown', onKey);
    }
    function onKey(e){
      if (e.key === 'Escape') closeModal();
      if (e.key === 'Tab'){
        const focusables = modal.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');
        const list = Array.from(focusables).filter(el=>!el.disabled && el.offsetParent!==null);
        if(!list.length) return;
        const first = list[0], last = list[list.length-1];
        if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
      }
    }

    fab.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

    modal.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        try{ await navigator.clipboard.writeText(btn.dataset.copy); btn.textContent=copySuccess; setTimeout(()=>btn.textContent=copyLabel,1200); }
        catch{ btn.textContent=copyFailed; setTimeout(()=>btn.textContent=copyLabel,1200); }
      });
    });
  })();
  </script>

  {% include "includes/analytics_tracker.html" %}
  {% endif %}
</body>
</html>

     
