{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>BGM Customs — Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#000; --fg:#fff; --muted:rgba(255,255,255,.72); --muted-2:rgba(255,255,255,.55);
      --line:rgba(255,255,255,.12); --panel:#0E0E0E; --panel-2:#131313;
      --accent:#d50000; --accent-2:#ff1a1a; --ok:#17d45b;
      --radius-lg:1.25rem; --radius-sm:.6rem; --shadow:0 10px 30px rgba(0,0,0,.45);
      --container:clamp(320px,92vw,1280px);
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px;scroll-behavior:smooth}
    body{background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;line-height:1.55}
    img{max-width:100%;display:block}
    .container{width:var(--container);margin-inline:auto;padding-inline:1rem}
    a{color:inherit;text-decoration:none}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}

    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.6em;padding:.78rem 1.15rem;border-radius:var(--radius-sm);
      font-weight:800;letter-spacing:.3px;cursor:pointer;transition:.24s;border:1px solid transparent;user-select:none}
    .btn:disabled{opacity:.45;cursor:not-allowed}
    .btn--primary{background:var(--accent);color:#fff}
    .btn--primary:hover{transform:translateY(-2px);box-shadow:0 12px 22px rgba(213,0,0,.25)}
    .btn--ghost{background:transparent;border-color:var(--line);color:var(--fg)}
    .btn--ghost:hover{border-color:var(--accent);color:var(--accent)}
    .btn--link{padding:0;border:none;background:transparent;color:var(--accent)}
    .badge{display:inline-block;font-size:.78rem;padding:.15rem .55rem;border-radius:999px;background:var(--accent);color:#fff}

    .site-header{position:sticky;top:0;z-index:1000;background:rgba(0,0,0,.65);backdrop-filter:saturate(1.2) blur(8px);border-bottom:1px solid var(--line)}
    .site-header__inner{display:flex;align-items:center;gap:1rem;justify-content:space-between;padding:.8rem 0}
    .brand{display:flex;align-items:center;gap:.75rem;font-weight:900;letter-spacing:.5px}
    .brand__logo{width:34px;height:34px;border-radius:10px;background:radial-gradient(90% 90% at 30% 30%, var(--accent-2), var(--accent));box-shadow:0 0 40px -6px var(--accent-2)}
    nav ul{display:flex;align-items:center;gap:.75rem;list-style:none}
    nav a{display:inline-flex;align-items:center;gap:.45rem;padding:.55rem .8rem;border-radius:.55rem}
    nav a[aria-current="page"]{background:var(--panel);border:1px solid var(--line)}
    .nav--soon{opacity:.55;pointer-events:none}
    .nav--soon .badge{background:transparent;border:1px solid var(--line);color:var(--muted-2)}

    .hero{position:relative;overflow:hidden;background:
      radial-gradient(1000px 420px at 10% -10%, rgba(255,26,26,.15), transparent 60%),
      radial-gradient(800px 360px at 90% 0%, rgba(213,0,0,.18), transparent 65%),
      linear-gradient(180deg,#070707 0%, #000 100%)}
    .hero__inner{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;padding:clamp(2rem,6vw,4.5rem) 0;align-items:center}
    .hero__title{font-size:clamp(2rem,4.6vw,3.4rem);font-weight:900;line-height:1.15}
    .hero__lead{color:var(--muted);font-size:clamp(1rem,1.5vw,1.15rem);max-width:54ch;margin-top:1rem}
    .hero__cta{display:flex;gap:.8rem;margin-top:1.35rem;flex-wrap:wrap}
    .stat{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);border-radius:var(--radius-lg);padding:1rem 1.1rem;box-shadow:var(--shadow)}
    .stat b{font-size:1.35rem}
    .frame{border-radius:1.2rem;border:1px solid var(--line);background:linear-gradient(180deg,#0b0b0b,#0a0a0a);box-shadow:inset 0 0 0 1px rgba(255,255,255,.02), 0 14px 28px rgba(0,0,0,.45);aspect-ratio:16/10;display:flex;align-items:center;justify-content:center;color:var(--muted-2)}
.frame--media { position: relative; overflow: hidden; }
.frame--media img{
  width:100%; height:100%; object-fit:cover; display:block;
  filter:contrast(1.05);
}
.frame__play{
  position:absolute; inset:0; margin:auto; width:72px; height:72px;
  border-radius:999px; display:grid; place-items:center; font-size:28px;
  background:rgba(0,0,0,.45); backdrop-filter:blur(4px);
  border:1px solid rgba(255,255,255,.18); color:#fff;
}

    .section{padding:clamp(2rem,6vw,4rem) 0;border-top:1px solid var(--line)}
    .section__head{display:flex;align-items:end;justify-content:space-between;margin-bottom:1.1rem;gap:1rem}
    .section__title{font-size:1.6rem;font-weight:900}
    .section__desc{color:var(--muted-2)}
    .kicker{color:var(--muted-2);font-weight:800;letter-spacing:.18em;text-transform:uppercase;font-size:.78rem}

    .filters{display:flex;flex-wrap:wrap;gap:.65rem;margin:1rem 0 1.25rem}
    .input,.select{background:var(--panel);border:1px solid var(--line);color:var(--fg);padding:.65rem .85rem;border-radius:.55rem;font:inherit;min-width:210px}

    .grid{display:grid;gap:1rem}
    .grid--services{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .grid--products{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}

    .card{display:flex;flex-direction:column;gap:.75rem;padding:1rem;border-radius:1rem;background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);box-shadow:var(--shadow);transition:transform .22s ease}
    .card:hover{transform:translateY(-3px)}
    .card__img{position:relative;aspect-ratio:16/9;border-radius:.8rem;overflow:hidden;background:#0b0b0b;display:flex;align-items:center;justify-content:center;color:var(--muted-2);font-size:.95rem}
    .card__img img{width:100%;height:100%;object-fit:cover;display:block}
    .card__badge{position:absolute;left:.6rem;bottom:.6rem;font-size:.72rem;background:rgba(0,0,0,.55);color:#fff;border-radius:999px;padding:.18rem .55rem;border:1px solid rgba(255,255,255,.14);backdrop-filter: blur(4px) saturate(120%)}
    .card__head{display:flex;align-items:center;justify-content:space-between;gap:.5rem}
    .price{display:flex;gap:.5rem;align-items:baseline;white-space:nowrap}
    .old{color:var(--muted-2);text-decoration:line-through}
    .dur{color:var(--muted-2);font-size:.92rem}
    .empty{color:var(--muted-2);font-style:italic;padding:1rem}

    .tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}
    .tile{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);border-radius:1rem;padding:1rem}
    .tile__icon{font-size:1.4rem;color:var(--accent);margin-bottom:.25rem}

    details{background:var(--panel);border:1px solid var(--line);border-radius:.8rem;padding:.8rem}
    summary{cursor:pointer;font-weight:700}
    details p{margin-top:.5rem;color:var(--muted)}

    .site-footer{border-top:1px solid var(--line);padding:1.6rem 0;color:var(--muted-2);font-size:.95rem}
    .footer__grid{display:grid;grid-template-columns:1.2fr .8fr;gap:1rem}
    .footer__nav{display:flex;gap:.75rem;flex-wrap:wrap}

    .sk{height:140px;border-radius:.8rem;background:linear-gradient(90deg,#111,#151515,#111);background-size:200% 100%;animation:sh 1.1s ease-in-out infinite}
    .ph{width:100%;height:100%;background:linear-gradient(90deg,#111,#151515,#111);background-size:200% 100%;animation:sh 1.1s ease-in-out infinite}
    @keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}

    @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}

    /* smoke layer */
#bg{position:fixed; inset:0; z-index:0; pointer-events:none;}
#bg canvas{position:absolute; inset:0; width:100%; height:100%; display:block;}

/* контент поверх дыма */
.site-header, .hero, main, .site-footer{position:relative; z-index:1;}

/* показываем дым за hero — убираем градиент */
.hero{background:transparent !important;}
.brand__logo {
  display: inline-flex;
  gap: .4rem;
  font-weight: 700;
  font-size: 1.1rem;
  letter-spacing: .05em;
}

.brand__word--white { color: #fff; }
.brand__word--red   { color: #d50000; }

.brand__tagline {
  margin-left: 1rem;
  font-size: .85rem;
  letter-spacing: .08em;
  color: rgba(255,255,255,.72);
  white-space: nowrap;
}
/* === Header: solid, без blur/overlay === */
.site-header{
  position: sticky; top: 0; z-index: 1000;
  background: #000;                 /* было rgba + backdrop */
  backdrop-filter: none;
  border-bottom: 1px solid var(--line);
}
.site-header__inner{ padding:.7rem 0; }

/* === Лого-надпись как на референсе === */
.brand{ display:flex; align-items:center; gap:.8rem; font-weight:900; }

/* Сброс квадрата */
.brand__logo{
  all: unset;                       /* убирает width/height/bg/shadow и т.п. */
  display: inline-flex;
  gap: .45rem;
  line-height: 1;
  font-size: 1rem;                  /* размер слова BAD GUY / MOTORS */
  letter-spacing: .06em;
}

/* Цвета слов */
.brand__word--white{ color:#fff; }
.brand__word--red{ color:#d50000; }

/* Теглайн справа */
.brand__tagline{
  margin-left: 1rem;
  font-size: .8rem;
  letter-spacing: .14em;
  color: rgba(255,255,255,.72);
  white-space: nowrap;
  font-weight: 800;
}

/* Раскладка: лого слева, нав полосу справа */
.site-header__inner{
  display:grid;
  grid-template-columns:auto 1fr;
  align-items:center;
}

/* Ссылки в навигации = как теглайн */
.site-header nav ul{
  display:flex; align-items:center; flex-wrap:wrap;
  justify-content:flex-end;
}
.site-header nav li{display:flex; align-items:center}

/* разделитель • между ссылками */
.site-header nav li + li::before{
  content:"•";
  margin:0 .75rem;
  color:rgba(255,255,255,.45);
  font-weight:900;
  letter-spacing:.12em;
}

/* стиль самих ссылок */
.site-header nav a{
  background:none !important;
  border:0 !important;
  padding:.2rem 0 !important;
  text-transform:uppercase;
  font-weight:900;
  letter-spacing:.12em;
  font-size:.85rem;
  color:rgba(255,255,255,.72);
  border-radius:0;
}
.site-header nav a:hover,
.site-header nav a[aria-current="page"]{
  color:#fff;
}


/* ===== HEADER LAYOUT ===== */
.site-header__inner{
  display:flex; align-items:center; gap:1.25rem; padding:.7rem 0;
}
.site-header .brand{display:flex; align-items:baseline; gap:.9rem; min-width:max-content;}
.brand__logo{all:unset; display:inline-flex; gap:.5rem; line-height:1; font-weight:900; letter-spacing:.06em; font-size:1rem;}
.brand__word--white{color:#fff;} .brand__word--red{color:#d50000;}
.brand__tagline{margin-left:1.1rem; font-size:.82rem; letter-spacing:.14em; color:rgba(255,255,255,.72); white-space:nowrap; font-weight:800}

/* ===== NAV: EVEN LAYOUT + BULLETS ===== */
.site-header nav{flex:1 1 auto;}
.site-header nav ul{
  display:flex; align-items:center;
  justify-content:space-evenly;      /* ровно растягиваем по правой зоне */
  gap:0; list-style:none;
  padding-left:1.2rem;
}
.site-header nav li{display:flex; align-items:center;}

/* Разделители • */
.site-header nav li + li::before{
  content:"•";
  margin:0 1.1rem;
  color:rgba(255,255,255,.38);
  font-weight:900; letter-spacing:.12em;
}

/* Ссылки в стиле слогана */
.site-header nav a{
  background:none!important; border:0!important; border-radius:0;
  padding:.2rem 0!important;
  text-transform:uppercase; font-weight:900; letter-spacing:.12em;
  font-size:.86rem; line-height:1;
  color:rgba(255,255,255,.72);
}
.site-header nav a:hover,
.site-header nav a[aria-current="page"]{ color:#fff; }

/* Бейдж "Soon" — по базовой линии и компактнее */
.site-header .badge{
  transform:translateY(-.04rem);
  padding:.12rem .5rem; font-size:.72rem;
}


/* Навигация в одну линию */
.site-header nav ul{
  display:flex; align-items:center;
  justify-content:flex-end;
  flex-wrap:nowrap;
  gap:1.6rem;             /* фиксированный равномерный отступ */
  list-style:none;
  margin:0; padding:0;
}

/* убираем точки-разделители */
.site-header nav li + li::before{content:none;}

/* ссылки компактнее */
.site-header nav a{
  text-transform:uppercase;
  font-weight:800;
  letter-spacing:.08em;   /* уменьшено */
  font-size:.82rem;
  color:rgba(255,255,255,.75);
  padding:0;
  background:none!important;
  border:none!important;
}
.site-header nav a:hover{color:#fff;}

/* Узкие экраны — убираем слоган и разделители, ужимаем трекинг */
@media (max-width: 1000px){
  .brand__tagline{display:none;}
  .site-header nav ul{justify-content:flex-end; gap:1rem;}
  .site-header nav li + li::before{content:""; margin:0;}
  .site-header nav a{letter-spacing:.08em;}
}

/* глушим «кнопочный» вид у Login */
.site-header nav a.btn--ghost{box-shadow:none}

/* адаптив: на узких убираем разделители и уменьшаем трекинг */
@media (max-width: 980px){
  .site-header nav li + li::before{content:""; margin:0}
  .site-header nav a{letter-spacing:.08em}
}

/* Подправим паддинги в навигации, чтобы всё легло в линию */
nav a{ padding:.5rem .7rem; }

/* На узких — убираем теглайн, чтобы не ломал сетку */
@media (max-width: 960px){
  .brand__tagline{ display:none; }
}

/* контейнер хэдера */
.site-header__inner{
  display:flex;
  align-items:center;
  justify-content:space-between; /* ключевой момент */
  gap:2rem;
}

/* бренд с теглайном всегда прижат влево */
.brand{
  display:flex;
  align-items:baseline;
  gap:.9rem;
  min-width:max-content;
}

/* навигация уходит вправо */
.site-header nav{
  margin-left:auto;
}

  </style>
</head>
<body>
  <div id="bg"></div>

<a href="#main" class="visually-hidden">Skip to main content</a>

<header class="site-header" role="banner">
  <div class="container site-header__inner">
    <a class="brand" href="/">
      <span class="brand__logo">
        <span class="brand__word brand__word--white">BAD GUY</span>
        <span class="brand__word brand__word--red">MOTORS</span>
      </span>
      <span class="brand__tagline">CUSTOM BUILDS • INSTALLS • UPGRADES</span>
    </a>

    <nav aria-label="Main navigation">
      <ul>
        <li><a href="{% url 'client-dashboard' %}" title="Services catalog">Services</a></li>
        {% if user.is_authenticated %}
          <li><a href="{% url 'dashboard' %}">Client Portal</a></li>
        {% else %}
          <li><a href="{% url 'login' %}?next={% url 'dashboard' %}" class="btn btn--ghost">Login</a></li>
        {% endif %}
        <li><a href="{% url 'store' %}" >Products</a></li>
        <li><a href="{% url 'merch' %}">Merch <span class="badge">Soon</span></a></li>
        <li><a href="{% url 'dealer-status' %}">Dealers</a></li>
        <li><a href="{% url 'financing' %}" {% if current == 'financing' %}aria-current="page"{% endif %}>Financing</a></li>
        <li><a href="{% url 'our-story' %}">About</a></li>
      </ul>
    </nav>
  </div>
</header>


<section class="hero" id="top">
  <div class="container hero__inner">
    <div>
      <p class="kicker">Custom fabrication • Diesel performance</p>
      <h1 class="hero__title">Built to be bad. Engineered to last.</h1>
      <p class="hero__lead">Bad Guy Motors is Medicine Hat’s premier custom fab and diesel shop. We design and build bumpers, body swaps, lift kits & four-links, and performance upgrades—then finish them with Armadillo or Smooth Criminal Liner. Book a consult and we’ll map your build from concept to keys.</p>
      <div class="hero__cta">
        <a class="btn btn--primary" href="#services">Explore services</a>
        <a class="btn btn--ghost" href="{% url 'client-dashboard' %}#services">Booking</a>
      </div>

      <div style="display:flex;gap:.6rem;margin-top:1.2rem;flex-wrap:wrap">
        <div class="stat"><b>Alberta-made</b><br><span class="muted">built in Medicine Hat</span></div>
        <div class="stat"><b>Custom only</b><br><span class="muted">no cookie‑cutter kits</span></div>
        <div class="stat"><b>24/7</b><br><span class="muted">Book online fast quotes</span></div>
      </div>
    </div>

    <div class="frame frame--media">
  <img src="{% static 'img/hero-preview.png' %}" alt="BGM Customs — project preview" loading="lazy" decoding="async">

</div>

  </div>
</section>

<main id="main">
  <!-- ========================= SERVICES on Home (limit 8) ========================= -->
  <section id="services" class="section">
    <div class="container">
      <div class="section__head">
        <div>
          <h2 class="section__title">What we build</h2>
          <p class="section__desc">From bolt‑on to one‑off: bumpers, chase racks, headache racks, mudflaps, running boards, lift kits & 4‑links, diesel tuning & hard parts, coatings & liners, body swaps, and more. Browse packages or request a custom quote.</p>
        </div>
        <div><a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">Open services </a></div>
      </div>

      <!-- Filters -->
      <form class="filters" role="search" method="get" action="{% url 'client-dashboard' %}">
        <input class="input" type="search" name="q" placeholder="Search a service…" value="{{ q|default:'' }}">
        <select class="select" name="cat" aria-label="Category">
          <option value="">All categories</option>
          {% for c in filter_categories %}
            <option value="{{ c.id }}" {% if active_category == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
        <button class="btn btn--ghost" type="submit">Search</button>
        {% if q or active_category %}
          <a class="btn btn--link" href="{% url 'client-dashboard' %}#services">Reset filters</a>
        {% endif %}
      </form>

      <!-- Live search -->
      <h3 id="liveTitle" class="kicker" style="display:none">Search results</h3>
      <div id="liveGrid" class="grid grid--services" style="display:none"></div>

      <!-- Server-rendered -->
      <div id="serverContent">
        {% if search_results %}
          <h3 class="kicker" style="margin:.5rem 0 1rem">Results</h3>
          <div class="grid grid--services">
            {% for s in search_results|slice:":8" %}
              <article class="card">
                <div class="card__img">
                  {% if s.image %}<img src="{{ s.image.url }}" alt="{{ s.name }}" loading="lazy" decoding="async">{% else %}<div class="ph" aria-hidden="true"></div>{% endif %}
                  {% if s.category %}<span class="card__badge">{{ s.category.name }}</span>{% endif %}
                </div>
                <div class="card__head">
                  <h3 style="font-weight:900">{{ s.name }}</h3>
                  <div class="price">
                    {% with disc=s.get_active_discount %}
                      {% if disc %}
                        <span class="old">${{ s.base_price|floatformat:2 }}</span>
                        <strong>${{ s.get_discounted_price|floatformat:2 }}</strong>
                        <span class="badge">-{{ disc.discount_percent|floatformat:0 }}%</span>
                      {% else %}
                        <strong>${{ s.base_price|floatformat:2 }}</strong>
                      {% endif %}
                    {% endwith %}
                  </div>
                </div>
                {% if s.description %}<p class="muted">{{ s.description|truncatewords:26 }}</p>{% endif %}
                <div class="dur">Duration: {{ s.duration_min }} min</div>
                <div style="margin-top:.4rem">
                  <a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">Book now</a>
                </div>
              </article>
            {% empty %}
              <div class="empty">No results for your query.</div>
            {% endfor %}
          </div>
          <hr style="margin:1.5rem 0;border:0;border-top:1px solid var(--line)">
        {% endif %}

        {% if home_services %}
          <h3 class="kicker" style="margin:.5rem 0 1rem">Featured services</h3>
          <div class="grid grid--services">
            {% for s in home_services|slice:":8" %}
              <article class="card">
                <div class="card__img">
                  {% if s.image %}<img src="{{ s.image.url }}" alt="{{ s.name }}" loading="lazy" decoding="async">{% else %}<div class="ph" aria-hidden="true"></div>{% endif %}
                  {% if s.category %}<span class="card__badge">{{ s.category.name }}</span>{% endif %}
                </div>
                <div class="card__head">
                  <h3 style="font-weight:900">{{ s.name }}</h3>
                  <div class="price">
                    {% with disc=s.get_active_discount %}
                      {% if disc %}
                        <span class="old">${{ s.base_price|floatformat:2 }}</span>
                        <strong>${{ s.get_discounted_price|floatformat:2 }}</strong>
                        <span class="badge">-{{ disc.discount_percent|floatformat:0 }}%</span>
                      {% else %}
                        <strong>${{ s.base_price|floatformat:2 }}</strong>
                      {% endif %}
                    {% endwith %}
                  </div>
                </div>
                {% if s.description %}<p class="muted">{{ s.description|truncatewords:26 }}</p>{% endif %}
                <div class="dur">Duration: {{ s.duration_min }} min</div>
                <div style="margin-top:.4rem">
                  <a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">Book now</a>
                </div>
              </article>
            {% endfor %}
          </div>
        {% elif not search_results and not has_any_services %}
          <div class="empty">The catalog will be available soon 👍</div>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- ========================= PRODUCTS ========================= -->
  <section id="products" class="section">
    <div class="container">
      <div class="section__head">
        <div>
          <h2 class="section__title">Products</h2>
          <p class="section__desc">Performance parts curated by BGM. Fresh stock, ready to ship.</p>
        </div>
        <div><a class="btn btn--primary" href="{% url 'store' %}">Open products</a></div>
      </div>

      {% if home_products %}
        <div class="grid grid--products">
          {% for p in home_products|slice:":8" %}
            <article class="card">
              <a href="{% url 'store-product' slug=p.slug %}">
                <div class="card__img">
                  {% if p.main_image %}<img src="{{ p.main_image.url }}" alt="{{ p.name }}" loading="lazy" decoding="async">
                  {% elif p.image %}<img src="{{ p.image.url }}" alt="{{ p.name }}" loading="lazy" decoding="async">
                  {% else %}<div class="ph" aria-hidden="true"></div>{% endif %}
                  {% if p.category %}<span class="card__badge">{{ p.category.name }}</span>{% endif %}
                </div>
                <div class="card__head" style="margin-top:.35rem">
                  <h3 style="font-weight:900">{{ p.name }}</h3>
                  <div class="price">
                    <strong>${{ p.price }}</strong>
                    {% if p.old_price %}<span class="old">${{ p.old_price }}</span>{% endif %}
                  </div>
                </div>
                {% if p.short_description %}<p class="muted">{{ p.short_description|truncatewords:20 }}</p>{% endif %}
              </a>
              <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.4rem">
                <form method="post" action="{% url 'store-cart-add' slug=p.slug %}">{% csrf_token %}
                  <button class="btn btn--primary" type="submit">Add to cart</button>
                </form>
                <a class="btn btn--ghost" href="{% url 'store-product' slug=p.slug %}">View</a>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty">
          No products yet. <a class="btn btn--link" href="{% url 'store' %}">Explore products</a>
        </div>
      {% endif %}
    </div>
  </section>

  <!-- ========================= HOW IT WORKS ========================= -->
  <section class="section">
    <div class="container">
      <div class="section__head">
        <h2 class="section__title">How we work</h2>
        <p class="section__desc">A transparent cycle—from booking to delivery.</p>
      </div>
      <div class="tiles">
        <div class="tile"><div class="tile__icon">①</div><b>Consult & scope</b><p class="muted">Tell us your goals, budget, and timeline.</p></div>
        <div class="tile"><div class="tile__icon">②</div><b>Design & quote</b><p class="muted">CAD as needed, milestones, and a written estimate.</p></div>
        <div class="tile"><div class="tile__icon">③</div><b>Fabricate & update</b><p class="muted">Progress pics, approvals, and clear communication.</p></div>
        <div class="tile"><div class="tile__icon">④</div><b>Delivery & aftercare</b><p class="muted">Test drive, torque check, and a care guide.</p></div>
      </div>
    </div>
  </section>

  <!-- ========================= WHY BGM ========================= -->
  <section class="section">
    <div class="container">
      <div class="section__head">
        <h2 class="section__title">Why choose BGM</h2>
        <p class="section__desc">We combine aesthetics with engineering discipline.</p>
      </div>
      <div class="tiles">
        <div class="tile"><div class="tile__icon">★</div><b>No‑compromise materials</b><p class="muted">DOM tubing, proper hardware, and proven parts.</p></div>
        <div class="tile"><div class="tile__icon">⏱</div><b>On‑time, transparent</b><p class="muted">Real timelines, clear updates, zero guesswork.</p></div>
        <div class="tile"><div class="tile__icon">🔒</div><b>Built for abuse</b><p class="muted">Designed to work hard, not just look pretty.</p></div>
        <div class="tile"><div class="tile__icon">💬</div><b>Warranty & support
</b><p class="muted">We stand behind our work and make things right.</p></div>
      </div>
    </div>
  </section>

  <!-- ========================= FAQ ========================= -->
  <section class="section">
    <div class="container">
      <div class="section__head">
        <h2 class="section__title">FAQ</h2>
        <p class="section__desc">Short and sweet</p>
      </div>
      <div class="grid">
        <details><summary>Do I need a prepayment?</summary><p>For some services — yes (the “prepayment” option in the service card). Others — pay upon completion.</p></details>
        <details><summary>Can I reschedule?</summary><p>Yes. In the client portal you can cancel or reschedule, and we’ll auto-suggest free slots.</p></details>
        <details><summary>Do you work with companies and dealers?</summary><p>Yes. The “Dealers” section is coming soon. Leave a request via the contact form.</p></details>
      </div>
    </div>
  </section>

  <!-- ========================= FINAL CTA ========================= -->
  <section class="section" aria-labelledby="cta">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap">
      <div>
        <h2 id="cta" class="section__title">Ready to upgrade?</h2>
        <p class="section__desc">We’ll secure your slot and lock the terms today.</p>
      </div>
      <div style="display:flex;gap:.6rem">
        <a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">Explore services</a>
        {% if user.is_authenticated %}
          <a class="btn btn--ghost" href="{% url 'dashboard' %}">Client Portal</a>
        {% else %}
          <a class="btn btn--ghost" href="{% url 'login' %}?next={% url 'dashboard' %}">Login</a>
        {% endif %}
      </div>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer__grid">
    <div>
      <div class="brand" style="margin-bottom:.3rem">
        <span class="brand__logo" aria-hidden="true"></span>
        <span>BGM Customs</span>
      </div>
      <div class="section__desc">© {{ now|date:"Y" }} BGM. All rights reserved.</div>
    </div>
    <nav class="footer__nav" aria-label="Footer">
      <a href="{% url 'client-dashboard' %}">Services</a>
      {% if user.is_authenticated %}
        <a href="{% url 'dashboard' %}">Client Portal</a>
      {% else %}
        <a href="{% url 'login' %}?next={% url 'dashboard' %}">Login</a>
      {% endif %}
      <a href="{% url 'store' %}" aria-current="page">Products</a>
      <a href="{% url 'merch' %}">Merch <span class="badge">Soon</span></a>
      <a href="{% url 'dealer-status' %}">Dealers</a>

    </nav>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="{% static 'admin/js/bgm-smoke.js' %}"></script>

  </div>
</footer>

<script>
(function(){
  // Live search with images
  const qInput = document.querySelector('input[name="q"]');
  const catSel = document.querySelector('select[name="cat"]');
  const liveTitle = document.getElementById('liveTitle');
  const liveGrid  = document.getElementById('liveGrid');
  const server    = document.getElementById('serverContent');
  if(!qInput || !catSel) return;

  const skel = (n=8)=> Array.from({length:n}).map(()=>'<div class="sk"></div>').join('');
  const showLive = ()=>{ liveTitle.style.display='block'; liveGrid.style.display='grid'; server.style.display='none'; }
  const hideLive = ()=>{ liveTitle.style.display='none'; liveGrid.style.display='none'; server.style.display='block'; }
  const esc = s => (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));

  function cardHTML(s){
    const hasDisc = Number.isFinite(+s.discount_percent) && +s.discount_percent>0;
    const price = hasDisc
      ? `<span class="old">$${esc(s.base_price)}</span> <strong>$${esc(s.price)}</strong> <span class="badge">-${esc(String(s.discount_percent))}%</span>`
      : `<strong>$${esc(s.price||s.base_price)}</strong>`;
    const media = s.image ? `<img src="${esc(s.image)}" alt="${esc(s.name)}" loading="lazy" decoding="async">` : `<div class="ph" aria-hidden="true"></div>`;
    const cat   = s.category ? `<span class="card__badge">${esc(s.category)}</span>` : '';
    const desc  = s.description ? `<p class="muted">${esc(s.description)}</p>` : '';
    return `
      <article class="card">
        <div class="card__img">${media}${cat}</div>
        <div class="card__head">
          <h3 style="font-weight:900">${esc(s.name)}</h3>
          <div class="price">${price}</div>
        </div>
        ${desc}
        <div class="dur">Duration: ${esc(String(s.duration_min))} min</div>
        <div style="margin-top:.4rem"><a class="btn btn--primary" href="{% url 'client-dashboard' %}#services">Book now</a></div>
      </article>`;
  }

  function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
  let aborter=null;
  async function fetchServices(q,cat){
    if(aborter) aborter.abort();
    aborter = new AbortController();
    const p=new URLSearchParams(); if(q) p.set('q',q); if(cat) p.set('cat',cat);
    const r=await fetch(`/accounts/api/services/search/?${p.toString()}`,{signal:aborter.signal,credentials:'same-origin'});
    if(!r.ok) throw new Error('Load error'); return r.json();
  }

  const run = debounce(async ()=>{
    const q=qInput.value.trim(), cat=catSel.value;
    if(!q && !cat){ hideLive(); return; }
    showLive(); liveGrid.innerHTML = skel(8);
    try{
      const data=await fetchServices(q,cat);
      const items=(data&&data.results)||[];
      liveGrid.innerHTML = items.length ? items.map(cardHTML).join('') : `<div class="empty">Nothing found.</div>`;
    }catch{ liveGrid.innerHTML = `<div class="empty">Failed to load. Please try again.</div>`; }
  },300);

  qInput.addEventListener('input', run);
  catSel.addEventListener('change', run);
})();
</script>
</body>
</html>
